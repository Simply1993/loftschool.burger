/* Hamburger menu */
let hamburger = options => {
	let button = document.querySelector(options.button);
	let menu = document.querySelector(options.menu);
	let list = document.querySelector(".mobile-menu__list");

	let _openMenu = e => {
		e.preventDefault();

		menu.classList.toggle("active");
		document.body.classList.toggle("lock");
	};

	let _closeMenu = e => {
		e.preventDefault();

		if (e.target.className == "mobile-menu__link") {
			menu.classList.remove("active");
			document.body.classList.remove("lock");
		}
	};

	let addListeners = () => {
		button.addEventListener("click", _openMenu);
		list.addEventListener("click", _closeMenu);
	};

	return {
		init: addListeners
	};
};

hamburger({
	button: ".hamburger-menu-btn",
	menu: ".mobile-menu"
}).init();

/* Vertical Accordeon */
// let verticalAccordeon = (function (options) {
// 	let list = document.querySelector(options.listSelector);
// 	let itemsList = list.querySelectorAll('.accordeon__item');
//
// 	let _getHeight = function _getHeight(elem) {
// 		let height = elem.scrollHeight + 'px';
// 		return height;
// 	};
//
// 	let _toogleItems = function (e) {
// 		e.preventDefault();
//
// 		if (e.target.className == options.linkClass) {
// 			let item = e.target.parentNode;
// 			let contentItem = item.querySelector('.accordeon__item-content');
//
// 			if (!item.classList.contains(options.activeItemClass)) {
// 				_closeItems(itemsList);
// 				_openItem(item, contentItem);
// 			} else {
// 				_closeItem(item, contentItem);
// 			}
// 		}
// 	};
//
// 	let _openItem = function _openItem(item, contentItem) {
// 		let contentHeight = _getHeight(contentItem);
//
// 		item.classList.toggle(options.activeItemClass);
// 		contentItem.style.height = contentHeight;
// 	};
//
// 	let _closeItem = function _closeItem(item, contentItem) {
// 		contentItem.style.height = '';
// 		item.classList.remove(options.activeItemClass);
// 	};
//
// 	let _closeItems = function _closeItems(items) {
// 		for (let i = 0; i < items.length; i++) {
// 			let contentItem = items[i].querySelector('.accordeon__item-content');
// 			_closeItem(items[i], contentItem);
// 		}
// 	};
//
// 	let addListeners = function () {
// 		list.addEventListener('click', _toogleItems)
// 	};
//
// 	return {
// 		init: addListeners
// 	}
// })({
// 	listSelector: ".accordeon__list",
// 	linkClass: "accordeon__trigger",
// 	activeItemClass: "accordeon__item--active",
// });
//
// verticalAccordeon.init();

/* Horizontal Accordeon */
// let horizontalAccordeon = (function (options) {
// 	let list = document.querySelector('.'+options.list);
// 	let itemsList = list.querySelectorAll('.'+options.item);
//
// 	/* calculate needed width */
// 	let userWidth = window.innerWidth;
// 	let titleItem = list.querySelector('.'+options.link);
// 	let widthTitle = titleItem.clientWidth;
// 	let neededWidth = userWidth - itemsList.length * widthTitle;
// 	console.log(neededWidth);
// 	neededWidth = (neededWidth > 520) ? 520 : neededWidth;
//
// 	let _toogleItems = function (e) {
// 		e.preventDefault();
//
// 		if (e.target.className == options.link) {
// 			let item = e.target.parentNode;
// 			let contentItem = item.querySelector('.'+options.content);
//
// 			if (!item.classList.contains(options.activeItem)) {
// 				_closeItems(itemsList);
// 				_openItem(item, contentItem);
// 			} else {
// 				_closeItem(item, contentItem);
// 			}
// 		}
// 	};
//
// 	let _openItem = function _openItem(item, contentItem) {
// 		item.classList.toggle(options.activeItem);
// 		contentItem.style.width = neededWidth + 'px';
// 	};
//
// 	let _closeItem = function _closeItem(item, contentItem) {
// 		contentItem.style.width = '';
// 		item.classList.remove(options.activeItem);
// 	};
//
// 	let _closeItems = function _closeItems(items) {
// 		for (let i = 0; i < items.length; i++) {
// 			let contentItem = items[i].querySelector('.'+options.content);
// 			_closeItem(items[i], contentItem);
// 		}
// 	};
//
// 	let addListeners = function () {
// 		list.addEventListener('click', _toogleItems)
// 	};
//
// 	return {
// 		init: addListeners
// 	}
// })({
// 	list: "menu-accordeon__list",
// 	item: "menu-accordeon__item",
// 	activeItem: "menu-accordeon__item--active",
// 	link: "menu-accordeon__trigger",
// 	content: "menu-accordeon__item-content"
// });
//
// horizontalAccordeon.init();

/* Multi-accordeon */
let multiAcco = options => {
	let list = document.querySelector('.' + options.list);
	let itemsList = list.querySelectorAll('.' + options.item);

	if (options.direction == "horizontal") {
		/* for calculate needed width */
		let userWidth = window.innerWidth;
		let titleItem = list.querySelector('.' + options.link);
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
	} else if (options.direction == "vertical") {
		/* for calculate needed height */
		var _getHeight = elem => elem.scrollHeight + 'px';
	}

	let _toogleItems = e => {
		e.preventDefault();

		if (e.target.className == options.link) {
			let item = e.target.parentNode;
			let contentItem = item.querySelector('.' + options.content);

			if (!item.classList.contains(options.activeItem)) {
				_closeItems(itemsList);
				_openItem(item, contentItem);
			} else {
				_closeItem(item, contentItem);
			}
		}
	};

	let _openItem = (item, contentItem) => {
		if (options.direction == "horizontal") {
			contentItem.style.width = neededWidth;
		} else if (options.direction == "vertical") {
			let contentHeight = _getHeight(contentItem);
			contentItem.style.height = contentHeight;
		}
		item.classList.toggle(options.activeItem);
	};

	let _closeItem = (item, contentItem) => {
		if (options.direction == "horizontal") {
			contentItem.style.width = '';
		} else if (options.direction == "vertical") {
			contentItem.style.height = '';
		}

		item.classList.remove(options.activeItem);
	};

	let _closeItems = items => {
		for (let i = 0; i < items.length; i++) {
			let contentItem = items[i].querySelector('.' + options.content);
			_closeItem(items[i], contentItem);
		}
	};

	let addListeners = () => {
		list.addEventListener('click', _toogleItems)
	};

	return {
		init: addListeners
	}
};

multiAcco({
	direction: "horizontal",
	list: "menu-accordeon__list",
	item: "menu-accordeon__item",
	activeItem: "menu-accordeon__item--active",
	link: "menu-accordeon__trigger",
	content: "menu-accordeon__item-content"
}).init();

multiAcco({
	direction: "vertical",
	list: "accordeon__list",
	item: "accordeon__item",
	activeItem: "accordeon__item--active",
	link: "accordeon__trigger",
	content: "accordeon__item-content"
}).init();

/* popup */
let popup = options => {
	let wrapper = document.querySelector('.' + options.wrapper);

	let _tooglePopup = e => {
		e.preventDefault();

		if (e.target.className == options.btn) {
			_openPopup(e.target);
		}
	};

	let _openPopup = btn => {
		let overlayElement = document.createElement('div');
		overlayElement.classList.add('overlay');

		let popupElement = document.createElement('div');
		popupElement.classList.add('popup');

		let contentElement = document.createElement('div');
		contentElement.classList.add('popup__content');

		let content = btn.parentNode;

		let text = content
			.querySelector('.' + options.text)
			.textContent;
		contentElement.innerHTML = text;

		let titleElement = document.createElement('div');
		titleElement.classList.add('popup__title');

		let title = content
			.querySelector('.' + options.title)
			.textContent;
		titleElement.innerHTML = title;

		let closeElement = document.createElement("a");
		closeElement.classList.add("popup__close");
		closeElement.innerHTML = '<svg class="popup__close-picture"><use xlink:href="./img/icons/mysprite.svg#close"></use></svg>';
		closeElement.href = "#";
		closeElement.addEventListener("click", e => {
			e.preventDefault();
			_closePopup(overlayElement);
		});

		overlayElement.appendChild(popupElement);
		popupElement.appendChild(titleElement);
		popupElement.appendChild(contentElement);
		popupElement.appendChild(closeElement);

		document.body.appendChild(overlayElement);
	};

	let _closePopup = overlay => {
		document.body.removeChild(overlay);
	};

	let addListeners = () => {
		wrapper.addEventListener('click', _tooglePopup)
	};

	return {
		init: addListeners
	}
};

popup({
	wrapper: "reviews__list",
	btn: "reviews__button",
	title: "reviews__title",
	text: "reviews__text"
}).init();

//check mobile devices
let checkMobile = () => {
	let isMobile = false;
	if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Opera Mobile|Kindle|Windows Phone|PSP|AvantGo|Atomic Web Browser|Blazer|Chrome Mobile|Dolphin|Dolfin|Doris|GO Browser|Jasmine|MicroB|Mobile Firefox|Mobile Safari|Mobile Silk|Motorola Internet Browser|NetFront|NineSky|Nokia Web Browser|Obigo|Openwave Mobile Browser|Palm Pre web browser|Polaris|PS Vita browser|Puffin|QQbrowser|SEMC Browser|Skyfire|Tear|TeaShark|UC Browser|uZard Web|wOSBrowser|Yandex.Browser mobile/i.test(navigator.userAgent)) isMobile = true;
	return isMobile;
};

/* One Page Scroll */
let OnePageScroll = options => {
	let currentSection = 0;
	let content = document.querySelector('.' + options.content);
	let countSections = document.querySelectorAll('.' + options.section).length;
	let listLinks = document.querySelectorAll('[' + options.attribute + ']');
	let scroll = false;

	let _swipeDetected = element => {
		let startX,
			startY,
			distX,
			distY,
			deviation = 200, //deviation from main direction
			threshold = 150, //min range for swipe
			allowedTime = 1000, //max time for range
			elapsedTime, //runtime
			startTime;

		element.addEventListener('touchstart', e => {
			let touchobj = e.changedTouches[0];
			startX = touchobj.pageX;
			startY = touchobj.pageY;
			startTime = new Date().getTime(); //time touch with sensor
		});

		//disable touchmove
		element.addEventListener('touchmove', e => e.preventDefault());

		element.addEventListener('touchend', e => {
			let touchobj = e.changedTouches[0];
			distX = touchobj.pageX - startX; //get horizontal move
			distY = touchobj.pageY - startY; //get vertical move
			elapsedTime = new Date().getTime() - startTime;
			if (elapsedTime <= allowedTime) {
				if (Math.abs(distY) >= threshold && Math.abs(distX) <= deviation) { //vertical swipe
					swipedir = (distY < 0) ? _slideToSection(currentSection + 1) : _slideToSection(currentSection - 1)
				}
			}
		});
	};

	let _slideToSection = (indexSection) => {
		if (!scroll) {
			if (indexSection >= 0 && indexSection < countSections) {
				currentSection = indexSection;

				scroll = true;

				let position = indexSection * -100 + '%';

				content.style.transform = `translateY(${position})`;
				content.style.webkitTransform = `translateY(${position})`;

				let sideNavElements = document.querySelectorAll('.' + options.sideNavigation);
				for (let i = 0; i < sideNavElements.length; i++) {
					if (i != indexSection) {
						sideNavElements[i].classList.remove(options.sideNavigation + '--active');
					} else {
						sideNavElements[i].classList.add(options.sideNavigation + '--active');
					}
				}

				setTimeout(() => {
					scroll = false;
				}, 1300);
			}
		}
	};

	//handlers for keyboard
	document.addEventListener('keydown', e => {
		switch (e.keyCode) {
			case 40: //down
				_slideToSection(currentSection + 1);
				break;
			case 38: //up
				_slideToSection(currentSection - 1);
				break;
		}
	});

	//handlers for links
	listLinks.forEach(item => {
		item.addEventListener('click', e => {
			e.preventDefault();
			let index = parseInt((e.target).getAttribute(options.attribute));
			//fix for button-down
			if (!(index >= 0)) {
				index = parseInt((e.currentTarget).getAttribute(options.attribute));
			}
			_slideToSection(index);
		});
	});

	//handlers for wheel
	document.addEventListener('wheel', e => {
		let deltaY = e.deltaY;

		let index = deltaY > 0 ? currentSection + 1 : currentSection - 1;

		_slideToSection(index);
	});

	//handlers for swipe
	if (checkMobile) {
		_swipeDetected(content);
	}
};

OnePageScroll({
	content: 'content',
	section: 'section',
	sideNavigation: 'side-navigation__item',
	attribute: 'data-scroll-to'
});

/* slider */
let slider = options => {
	let wrapper = document.querySelector('.'+options.wrapper);
	let widthWrapper = wrapper.clientWidth;
	wrapper.style.width = widthWrapper  + 'px';

	let list = document.querySelector('.'+options.list);
	let items = document.querySelectorAll('.'+options.item);

	let left = document.querySelector('.'+options.prev);
	let right = document.querySelector('.'+options.next);

	items.forEach(element => {
		element.style.width = widthWrapper  + 'px';
	});

	let minRight = 0;
	let maxRight = widthWrapper * (items.length - 1);
	let step = widthWrapper;
	let currentRight = 0;

	let _slideRight = value => {
		if (value <= maxRight) {
			currentRight += step;
			list.style.right = currentRight + "px";
		}
	};

	let _slideLeft = value => {
		if (value >= minRight) {
			currentRight -= step;
			list.style.right = currentRight + "px";
		}
	};

	let initial = () => {
		list.style.right = currentRight;

		right.addEventListener("click", e => {
			e.preventDefault();

			_slideRight(currentRight + step);
		});

		left.addEventListener("click", e => {
			e.preventDefault();

			_slideLeft(currentRight - step);
		});

		_swipeDetected(wrapper);
	};

	let _swipeDetected = element => {
		let startX,
			startY,
			distX,
			distY,
			deviation = 200, //deviation from main direction
			threshold = 150, //min range for swipe
			allowedTime = 1000, //max time for range
			elapsedTime, //runtime
			startTime;

		element.addEventListener('touchstart', e => {
			let touchobj = e.changedTouches[0];
			startX = touchobj.pageX;
			startY = touchobj.pageY;
			startTime = new Date().getTime(); //time touch with sensor
		});

		//disable touchmove
		element.addEventListener('touchmove', e => e.preventDefault());

		element.addEventListener('touchend', e => {
			let touchobj = e.changedTouches[0];
			distX = touchobj.pageX - startX; //get horizontal move
			distY = touchobj.pageY - startY; //get vertical move
			elapsedTime = new Date().getTime() - startTime;
			if (elapsedTime <= allowedTime) {
				if (Math.abs(distX) >= threshold && Math.abs(distY) <= deviation) { //horizontal swipe
					swipedir = (distX < 0) ? _slideRight(currentRight + step) : _slideLeft(currentRight - step)
				}
			}
		});
	};

	let _mobileIngredients = () => {
		let btnIngredients = document.querySelector('.burger__ingredients');
		let btnCloseIngredients = document.querySelector('.dropdown__close');

		btnCloseIngredients.addEventListener('click', e => {
			e.preventDefault();

			btnIngredients.classList.remove('active');
		});
		btnCloseIngredients.addEventListener('touchstart', e => {
			e.preventDefault();

			btnIngredients.classList.remove('active');
		});

		if (checkMobile) {
			btnIngredients.addEventListener('click', e => {
				btnIngredients.classList.add("active");
			});
		}
		btnIngredients.addEventListener('mouseenter', e => {
			btnIngredients.classList.add("active");
		});

		btnIngredients.addEventListener('mouseleave', e => {
			btnIngredients.classList.remove("active");
		});
	};
	_mobileIngredients();

	return {
		init: initial
	}
};

slider({
	wrapper: 'burger__wrapper',
	list: 'burger__list',
	item: 'burger__item',
	next: 'burger__controls-link--next',
	prev: 'burger__controls-link--prev'
}).init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogSGFtYnVyZ2VyIG1lbnUgKi9cclxubGV0IGhhbWJ1cmdlciA9IG9wdGlvbnMgPT4ge1xyXG5cdGxldCBidXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMuYnV0dG9uKTtcclxuXHRsZXQgbWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5tZW51KTtcclxuXHRsZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9iaWxlLW1lbnVfX2xpc3RcIik7XHJcblxyXG5cdGxldCBfb3Blbk1lbnUgPSBlID0+IHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRtZW51LmNsYXNzTGlzdC50b2dnbGUoXCJhY3RpdmVcIik7XHJcblx0XHRkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoXCJsb2NrXCIpO1xyXG5cdH07XHJcblxyXG5cdGxldCBfY2xvc2VNZW51ID0gZSA9PiB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0aWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBcIm1vYmlsZS1tZW51X19saW5rXCIpIHtcclxuXHRcdFx0bWVudS5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xyXG5cdFx0XHRkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJsb2NrXCIpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCBhZGRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcblx0XHRidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIF9vcGVuTWVudSk7XHJcblx0XHRsaXN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBfY2xvc2VNZW51KTtcclxuXHR9O1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcblx0fTtcclxufTtcclxuXHJcbmhhbWJ1cmdlcih7XHJcblx0YnV0dG9uOiBcIi5oYW1idXJnZXItbWVudS1idG5cIixcclxuXHRtZW51OiBcIi5tb2JpbGUtbWVudVwiXHJcbn0pLmluaXQoKTtcclxuXHJcbi8qIFZlcnRpY2FsIEFjY29yZGVvbiAqL1xyXG4vLyBsZXQgdmVydGljYWxBY2NvcmRlb24gPSAoZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuLy8gXHRsZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5saXN0U2VsZWN0b3IpO1xyXG4vLyBcdGxldCBpdGVtc0xpc3QgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRlb25fX2l0ZW0nKTtcclxuLy9cclxuLy8gXHRsZXQgX2dldEhlaWdodCA9IGZ1bmN0aW9uIF9nZXRIZWlnaHQoZWxlbSkge1xyXG4vLyBcdFx0bGV0IGhlaWdodCA9IGVsZW0uc2Nyb2xsSGVpZ2h0ICsgJ3B4JztcclxuLy8gXHRcdHJldHVybiBoZWlnaHQ7XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgX3Rvb2dsZUl0ZW1zID0gZnVuY3Rpb24gKGUpIHtcclxuLy8gXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuLy9cclxuLy8gXHRcdGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gb3B0aW9ucy5saW5rQ2xhc3MpIHtcclxuLy8gXHRcdFx0bGV0IGl0ZW0gPSBlLnRhcmdldC5wYXJlbnROb2RlO1xyXG4vLyBcdFx0XHRsZXQgY29udGVudEl0ZW0gPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX2l0ZW0tY29udGVudCcpO1xyXG4vL1xyXG4vLyBcdFx0XHRpZiAoIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKG9wdGlvbnMuYWN0aXZlSXRlbUNsYXNzKSkge1xyXG4vLyBcdFx0XHRcdF9jbG9zZUl0ZW1zKGl0ZW1zTGlzdCk7XHJcbi8vIFx0XHRcdFx0X29wZW5JdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKTtcclxuLy8gXHRcdFx0fSBlbHNlIHtcclxuLy8gXHRcdFx0XHRfY2xvc2VJdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKTtcclxuLy8gXHRcdFx0fVxyXG4vLyBcdFx0fVxyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IF9vcGVuSXRlbSA9IGZ1bmN0aW9uIF9vcGVuSXRlbShpdGVtLCBjb250ZW50SXRlbSkge1xyXG4vLyBcdFx0bGV0IGNvbnRlbnRIZWlnaHQgPSBfZ2V0SGVpZ2h0KGNvbnRlbnRJdGVtKTtcclxuLy9cclxuLy8gXHRcdGl0ZW0uY2xhc3NMaXN0LnRvZ2dsZShvcHRpb25zLmFjdGl2ZUl0ZW1DbGFzcyk7XHJcbi8vIFx0XHRjb250ZW50SXRlbS5zdHlsZS5oZWlnaHQgPSBjb250ZW50SGVpZ2h0O1xyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IF9jbG9zZUl0ZW0gPSBmdW5jdGlvbiBfY2xvc2VJdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKSB7XHJcbi8vIFx0XHRjb250ZW50SXRlbS5zdHlsZS5oZWlnaHQgPSAnJztcclxuLy8gXHRcdGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShvcHRpb25zLmFjdGl2ZUl0ZW1DbGFzcyk7XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgX2Nsb3NlSXRlbXMgPSBmdW5jdGlvbiBfY2xvc2VJdGVtcyhpdGVtcykge1xyXG4vLyBcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xyXG4vLyBcdFx0XHRsZXQgY29udGVudEl0ZW0gPSBpdGVtc1tpXS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uX19pdGVtLWNvbnRlbnQnKTtcclxuLy8gXHRcdFx0X2Nsb3NlSXRlbShpdGVtc1tpXSwgY29udGVudEl0ZW0pO1xyXG4vLyBcdFx0fVxyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcclxuLy8gXHRcdGxpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9vZ2xlSXRlbXMpXHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRyZXR1cm4ge1xyXG4vLyBcdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcbi8vIFx0fVxyXG4vLyB9KSh7XHJcbi8vIFx0bGlzdFNlbGVjdG9yOiBcIi5hY2NvcmRlb25fX2xpc3RcIixcclxuLy8gXHRsaW5rQ2xhc3M6IFwiYWNjb3JkZW9uX190cmlnZ2VyXCIsXHJcbi8vIFx0YWN0aXZlSXRlbUNsYXNzOiBcImFjY29yZGVvbl9faXRlbS0tYWN0aXZlXCIsXHJcbi8vIH0pO1xyXG4vL1xyXG4vLyB2ZXJ0aWNhbEFjY29yZGVvbi5pbml0KCk7XHJcblxyXG4vKiBIb3Jpem9udGFsIEFjY29yZGVvbiAqL1xyXG4vLyBsZXQgaG9yaXpvbnRhbEFjY29yZGVvbiA9IChmdW5jdGlvbiAob3B0aW9ucykge1xyXG4vLyBcdGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy5saXN0KTtcclxuLy8gXHRsZXQgaXRlbXNMaXN0ID0gbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuJytvcHRpb25zLml0ZW0pO1xyXG4vL1xyXG4vLyBcdC8qIGNhbGN1bGF0ZSBuZWVkZWQgd2lkdGggKi9cclxuLy8gXHRsZXQgdXNlcldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbi8vIFx0bGV0IHRpdGxlSXRlbSA9IGxpc3QucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy5saW5rKTtcclxuLy8gXHRsZXQgd2lkdGhUaXRsZSA9IHRpdGxlSXRlbS5jbGllbnRXaWR0aDtcclxuLy8gXHRsZXQgbmVlZGVkV2lkdGggPSB1c2VyV2lkdGggLSBpdGVtc0xpc3QubGVuZ3RoICogd2lkdGhUaXRsZTtcclxuLy8gXHRjb25zb2xlLmxvZyhuZWVkZWRXaWR0aCk7XHJcbi8vIFx0bmVlZGVkV2lkdGggPSAobmVlZGVkV2lkdGggPiA1MjApID8gNTIwIDogbmVlZGVkV2lkdGg7XHJcbi8vXHJcbi8vIFx0bGV0IF90b29nbGVJdGVtcyA9IGZ1bmN0aW9uIChlKSB7XHJcbi8vIFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcbi8vXHJcbi8vIFx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IG9wdGlvbnMubGluaykge1xyXG4vLyBcdFx0XHRsZXQgaXRlbSA9IGUudGFyZ2V0LnBhcmVudE5vZGU7XHJcbi8vIFx0XHRcdGxldCBjb250ZW50SXRlbSA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy5jb250ZW50KTtcclxuLy9cclxuLy8gXHRcdFx0aWYgKCFpdGVtLmNsYXNzTGlzdC5jb250YWlucyhvcHRpb25zLmFjdGl2ZUl0ZW0pKSB7XHJcbi8vIFx0XHRcdFx0X2Nsb3NlSXRlbXMoaXRlbXNMaXN0KTtcclxuLy8gXHRcdFx0XHRfb3Blbkl0ZW0oaXRlbSwgY29udGVudEl0ZW0pO1xyXG4vLyBcdFx0XHR9IGVsc2Uge1xyXG4vLyBcdFx0XHRcdF9jbG9zZUl0ZW0oaXRlbSwgY29udGVudEl0ZW0pO1xyXG4vLyBcdFx0XHR9XHJcbi8vIFx0XHR9XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgX29wZW5JdGVtID0gZnVuY3Rpb24gX29wZW5JdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKSB7XHJcbi8vIFx0XHRpdGVtLmNsYXNzTGlzdC50b2dnbGUob3B0aW9ucy5hY3RpdmVJdGVtKTtcclxuLy8gXHRcdGNvbnRlbnRJdGVtLnN0eWxlLndpZHRoID0gbmVlZGVkV2lkdGggKyAncHgnO1xyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IF9jbG9zZUl0ZW0gPSBmdW5jdGlvbiBfY2xvc2VJdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKSB7XHJcbi8vIFx0XHRjb250ZW50SXRlbS5zdHlsZS53aWR0aCA9ICcnO1xyXG4vLyBcdFx0aXRlbS5jbGFzc0xpc3QucmVtb3ZlKG9wdGlvbnMuYWN0aXZlSXRlbSk7XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgX2Nsb3NlSXRlbXMgPSBmdW5jdGlvbiBfY2xvc2VJdGVtcyhpdGVtcykge1xyXG4vLyBcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xyXG4vLyBcdFx0XHRsZXQgY29udGVudEl0ZW0gPSBpdGVtc1tpXS5xdWVyeVNlbGVjdG9yKCcuJytvcHRpb25zLmNvbnRlbnQpO1xyXG4vLyBcdFx0XHRfY2xvc2VJdGVtKGl0ZW1zW2ldLCBjb250ZW50SXRlbSk7XHJcbi8vIFx0XHR9XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgYWRkTGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xyXG4vLyBcdFx0bGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b29nbGVJdGVtcylcclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdHJldHVybiB7XHJcbi8vIFx0XHRpbml0OiBhZGRMaXN0ZW5lcnNcclxuLy8gXHR9XHJcbi8vIH0pKHtcclxuLy8gXHRsaXN0OiBcIm1lbnUtYWNjb3JkZW9uX19saXN0XCIsXHJcbi8vIFx0aXRlbTogXCJtZW51LWFjY29yZGVvbl9faXRlbVwiLFxyXG4vLyBcdGFjdGl2ZUl0ZW06IFwibWVudS1hY2NvcmRlb25fX2l0ZW0tLWFjdGl2ZVwiLFxyXG4vLyBcdGxpbms6IFwibWVudS1hY2NvcmRlb25fX3RyaWdnZXJcIixcclxuLy8gXHRjb250ZW50OiBcIm1lbnUtYWNjb3JkZW9uX19pdGVtLWNvbnRlbnRcIlxyXG4vLyB9KTtcclxuLy9cclxuLy8gaG9yaXpvbnRhbEFjY29yZGVvbi5pbml0KCk7XHJcblxyXG4vKiBNdWx0aS1hY2NvcmRlb24gKi9cclxubGV0IG11bHRpQWNjbyA9IG9wdGlvbnMgPT4ge1xyXG5cdGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLmxpc3QpO1xyXG5cdGxldCBpdGVtc0xpc3QgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgb3B0aW9ucy5pdGVtKTtcclxuXHJcblx0aWYgKG9wdGlvbnMuZGlyZWN0aW9uID09IFwiaG9yaXpvbnRhbFwiKSB7XHJcblx0XHQvKiBmb3IgY2FsY3VsYXRlIG5lZWRlZCB3aWR0aCAqL1xyXG5cdFx0bGV0IHVzZXJXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG5cdFx0bGV0IHRpdGxlSXRlbSA9IGxpc3QucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLmxpbmspO1xyXG5cdFx0bGV0IHdpZHRoVGl0bGUgPSB0aXRsZUl0ZW0uY2xpZW50V2lkdGg7XHJcblx0XHR2YXIgbmVlZGVkV2lkdGggPSB1c2VyV2lkdGggLSBpdGVtc0xpc3QubGVuZ3RoICogd2lkdGhUaXRsZTtcclxuXHRcdG5lZWRlZFdpZHRoID0gKG5lZWRlZFdpZHRoID4gNTIwKSA/ICc1MjBweCcgOiBuZWVkZWRXaWR0aCArICdweCc7XHJcblx0fSBlbHNlIGlmIChvcHRpb25zLmRpcmVjdGlvbiA9PSBcInZlcnRpY2FsXCIpIHtcclxuXHRcdC8qIGZvciBjYWxjdWxhdGUgbmVlZGVkIGhlaWdodCAqL1xyXG5cdFx0dmFyIF9nZXRIZWlnaHQgPSBlbGVtID0+IGVsZW0uc2Nyb2xsSGVpZ2h0ICsgJ3B4JztcclxuXHR9XHJcblxyXG5cdGxldCBfdG9vZ2xlSXRlbXMgPSBlID0+IHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IG9wdGlvbnMubGluaykge1xyXG5cdFx0XHRsZXQgaXRlbSA9IGUudGFyZ2V0LnBhcmVudE5vZGU7XHJcblx0XHRcdGxldCBjb250ZW50SXRlbSA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLmNvbnRlbnQpO1xyXG5cclxuXHRcdFx0aWYgKCFpdGVtLmNsYXNzTGlzdC5jb250YWlucyhvcHRpb25zLmFjdGl2ZUl0ZW0pKSB7XHJcblx0XHRcdFx0X2Nsb3NlSXRlbXMoaXRlbXNMaXN0KTtcclxuXHRcdFx0XHRfb3Blbkl0ZW0oaXRlbSwgY29udGVudEl0ZW0pO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdF9jbG9zZUl0ZW0oaXRlbSwgY29udGVudEl0ZW0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IF9vcGVuSXRlbSA9IChpdGVtLCBjb250ZW50SXRlbSkgPT4ge1xyXG5cdFx0aWYgKG9wdGlvbnMuZGlyZWN0aW9uID09IFwiaG9yaXpvbnRhbFwiKSB7XHJcblx0XHRcdGNvbnRlbnRJdGVtLnN0eWxlLndpZHRoID0gbmVlZGVkV2lkdGg7XHJcblx0XHR9IGVsc2UgaWYgKG9wdGlvbnMuZGlyZWN0aW9uID09IFwidmVydGljYWxcIikge1xyXG5cdFx0XHRsZXQgY29udGVudEhlaWdodCA9IF9nZXRIZWlnaHQoY29udGVudEl0ZW0pO1xyXG5cdFx0XHRjb250ZW50SXRlbS5zdHlsZS5oZWlnaHQgPSBjb250ZW50SGVpZ2h0O1xyXG5cdFx0fVxyXG5cdFx0aXRlbS5jbGFzc0xpc3QudG9nZ2xlKG9wdGlvbnMuYWN0aXZlSXRlbSk7XHJcblx0fTtcclxuXHJcblx0bGV0IF9jbG9zZUl0ZW0gPSAoaXRlbSwgY29udGVudEl0ZW0pID0+IHtcclxuXHRcdGlmIChvcHRpb25zLmRpcmVjdGlvbiA9PSBcImhvcml6b250YWxcIikge1xyXG5cdFx0XHRjb250ZW50SXRlbS5zdHlsZS53aWR0aCA9ICcnO1xyXG5cdFx0fSBlbHNlIGlmIChvcHRpb25zLmRpcmVjdGlvbiA9PSBcInZlcnRpY2FsXCIpIHtcclxuXHRcdFx0Y29udGVudEl0ZW0uc3R5bGUuaGVpZ2h0ID0gJyc7XHJcblx0XHR9XHJcblxyXG5cdFx0aXRlbS5jbGFzc0xpc3QucmVtb3ZlKG9wdGlvbnMuYWN0aXZlSXRlbSk7XHJcblx0fTtcclxuXHJcblx0bGV0IF9jbG9zZUl0ZW1zID0gaXRlbXMgPT4ge1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRsZXQgY29udGVudEl0ZW0gPSBpdGVtc1tpXS5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMuY29udGVudCk7XHJcblx0XHRcdF9jbG9zZUl0ZW0oaXRlbXNbaV0sIGNvbnRlbnRJdGVtKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXJzID0gKCkgPT4ge1xyXG5cdFx0bGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b29nbGVJdGVtcylcclxuXHR9O1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcblx0fVxyXG59O1xyXG5cclxubXVsdGlBY2NvKHtcclxuXHRkaXJlY3Rpb246IFwiaG9yaXpvbnRhbFwiLFxyXG5cdGxpc3Q6IFwibWVudS1hY2NvcmRlb25fX2xpc3RcIixcclxuXHRpdGVtOiBcIm1lbnUtYWNjb3JkZW9uX19pdGVtXCIsXHJcblx0YWN0aXZlSXRlbTogXCJtZW51LWFjY29yZGVvbl9faXRlbS0tYWN0aXZlXCIsXHJcblx0bGluazogXCJtZW51LWFjY29yZGVvbl9fdHJpZ2dlclwiLFxyXG5cdGNvbnRlbnQ6IFwibWVudS1hY2NvcmRlb25fX2l0ZW0tY29udGVudFwiXHJcbn0pLmluaXQoKTtcclxuXHJcbm11bHRpQWNjbyh7XHJcblx0ZGlyZWN0aW9uOiBcInZlcnRpY2FsXCIsXHJcblx0bGlzdDogXCJhY2NvcmRlb25fX2xpc3RcIixcclxuXHRpdGVtOiBcImFjY29yZGVvbl9faXRlbVwiLFxyXG5cdGFjdGl2ZUl0ZW06IFwiYWNjb3JkZW9uX19pdGVtLS1hY3RpdmVcIixcclxuXHRsaW5rOiBcImFjY29yZGVvbl9fdHJpZ2dlclwiLFxyXG5cdGNvbnRlbnQ6IFwiYWNjb3JkZW9uX19pdGVtLWNvbnRlbnRcIlxyXG59KS5pbml0KCk7XHJcblxyXG4vKiBwb3B1cCAqL1xyXG5sZXQgcG9wdXAgPSBvcHRpb25zID0+IHtcclxuXHRsZXQgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy53cmFwcGVyKTtcclxuXHJcblx0bGV0IF90b29nbGVQb3B1cCA9IGUgPT4ge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gb3B0aW9ucy5idG4pIHtcclxuXHRcdFx0X29wZW5Qb3B1cChlLnRhcmdldCk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IF9vcGVuUG9wdXAgPSBidG4gPT4ge1xyXG5cdFx0bGV0IG92ZXJsYXlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRvdmVybGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdvdmVybGF5Jyk7XHJcblxyXG5cdFx0bGV0IHBvcHVwRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0cG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3BvcHVwJyk7XHJcblxyXG5cdFx0bGV0IGNvbnRlbnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRjb250ZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9fY29udGVudCcpO1xyXG5cclxuXHRcdGxldCBjb250ZW50ID0gYnRuLnBhcmVudE5vZGU7XHJcblxyXG5cdFx0bGV0IHRleHQgPSBjb250ZW50XHJcblx0XHRcdC5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMudGV4dClcclxuXHRcdFx0LnRleHRDb250ZW50O1xyXG5cdFx0Y29udGVudEVsZW1lbnQuaW5uZXJIVE1MID0gdGV4dDtcclxuXHJcblx0XHRsZXQgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHR0aXRsZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncG9wdXBfX3RpdGxlJyk7XHJcblxyXG5cdFx0bGV0IHRpdGxlID0gY29udGVudFxyXG5cdFx0XHQucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLnRpdGxlKVxyXG5cdFx0XHQudGV4dENvbnRlbnQ7XHJcblx0XHR0aXRsZUVsZW1lbnQuaW5uZXJIVE1MID0gdGl0bGU7XHJcblxyXG5cdFx0bGV0IGNsb3NlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG5cdFx0Y2xvc2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9fY2xvc2VcIik7XHJcblx0XHRjbG9zZUVsZW1lbnQuaW5uZXJIVE1MID0gJzxzdmcgY2xhc3M9XCJwb3B1cF9fY2xvc2UtcGljdHVyZVwiPjx1c2UgeGxpbms6aHJlZj1cIi4vaW1nL2ljb25zL215c3ByaXRlLnN2ZyNjbG9zZVwiPjwvdXNlPjwvc3ZnPic7XHJcblx0XHRjbG9zZUVsZW1lbnQuaHJlZiA9IFwiI1wiO1xyXG5cdFx0Y2xvc2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRfY2xvc2VQb3B1cChvdmVybGF5RWxlbWVudCk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRvdmVybGF5RWxlbWVudC5hcHBlbmRDaGlsZChwb3B1cEVsZW1lbnQpO1xyXG5cdFx0cG9wdXBFbGVtZW50LmFwcGVuZENoaWxkKHRpdGxlRWxlbWVudCk7XHJcblx0XHRwb3B1cEVsZW1lbnQuYXBwZW5kQ2hpbGQoY29udGVudEVsZW1lbnQpO1xyXG5cdFx0cG9wdXBFbGVtZW50LmFwcGVuZENoaWxkKGNsb3NlRWxlbWVudCk7XHJcblxyXG5cdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5RWxlbWVudCk7XHJcblx0fTtcclxuXHJcblx0bGV0IF9jbG9zZVBvcHVwID0gb3ZlcmxheSA9PiB7XHJcblx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG92ZXJsYXkpO1xyXG5cdH07XHJcblxyXG5cdGxldCBhZGRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcblx0XHR3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3Rvb2dsZVBvcHVwKVxyXG5cdH07XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBhZGRMaXN0ZW5lcnNcclxuXHR9XHJcbn07XHJcblxyXG5wb3B1cCh7XHJcblx0d3JhcHBlcjogXCJyZXZpZXdzX19saXN0XCIsXHJcblx0YnRuOiBcInJldmlld3NfX2J1dHRvblwiLFxyXG5cdHRpdGxlOiBcInJldmlld3NfX3RpdGxlXCIsXHJcblx0dGV4dDogXCJyZXZpZXdzX190ZXh0XCJcclxufSkuaW5pdCgpO1xyXG5cclxuLy9jaGVjayBtb2JpbGUgZGV2aWNlc1xyXG5sZXQgY2hlY2tNb2JpbGUgPSAoKSA9PiB7XHJcblx0bGV0IGlzTW9iaWxlID0gZmFsc2U7XHJcblx0aWYgKC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pfE9wZXJhIE1vYmlsZXxLaW5kbGV8V2luZG93cyBQaG9uZXxQU1B8QXZhbnRHb3xBdG9taWMgV2ViIEJyb3dzZXJ8QmxhemVyfENocm9tZSBNb2JpbGV8RG9scGhpbnxEb2xmaW58RG9yaXN8R08gQnJvd3NlcnxKYXNtaW5lfE1pY3JvQnxNb2JpbGUgRmlyZWZveHxNb2JpbGUgU2FmYXJpfE1vYmlsZSBTaWxrfE1vdG9yb2xhIEludGVybmV0IEJyb3dzZXJ8TmV0RnJvbnR8TmluZVNreXxOb2tpYSBXZWIgQnJvd3NlcnxPYmlnb3xPcGVud2F2ZSBNb2JpbGUgQnJvd3NlcnxQYWxtIFByZSB3ZWIgYnJvd3NlcnxQb2xhcmlzfFBTIFZpdGEgYnJvd3NlcnxQdWZmaW58UVFicm93c2VyfFNFTUMgQnJvd3NlcnxTa3lmaXJlfFRlYXJ8VGVhU2hhcmt8VUMgQnJvd3Nlcnx1WmFyZCBXZWJ8d09TQnJvd3NlcnxZYW5kZXguQnJvd3NlciBtb2JpbGUvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSBpc01vYmlsZSA9IHRydWU7XHJcblx0cmV0dXJuIGlzTW9iaWxlO1xyXG59O1xyXG5cclxuLyogT25lIFBhZ2UgU2Nyb2xsICovXHJcbmxldCBPbmVQYWdlU2Nyb2xsID0gb3B0aW9ucyA9PiB7XHJcblx0bGV0IGN1cnJlbnRTZWN0aW9uID0gMDtcclxuXHRsZXQgY29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy5jb250ZW50KTtcclxuXHRsZXQgY291bnRTZWN0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgb3B0aW9ucy5zZWN0aW9uKS5sZW5ndGg7XHJcblx0bGV0IGxpc3RMaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1snICsgb3B0aW9ucy5hdHRyaWJ1dGUgKyAnXScpO1xyXG5cdGxldCBzY3JvbGwgPSBmYWxzZTtcclxuXHJcblx0bGV0IF9zd2lwZURldGVjdGVkID0gZWxlbWVudCA9PiB7XHJcblx0XHRsZXQgc3RhcnRYLFxyXG5cdFx0XHRzdGFydFksXHJcblx0XHRcdGRpc3RYLFxyXG5cdFx0XHRkaXN0WSxcclxuXHRcdFx0ZGV2aWF0aW9uID0gMjAwLCAvL2RldmlhdGlvbiBmcm9tIG1haW4gZGlyZWN0aW9uXHJcblx0XHRcdHRocmVzaG9sZCA9IDE1MCwgLy9taW4gcmFuZ2UgZm9yIHN3aXBlXHJcblx0XHRcdGFsbG93ZWRUaW1lID0gMTAwMCwgLy9tYXggdGltZSBmb3IgcmFuZ2VcclxuXHRcdFx0ZWxhcHNlZFRpbWUsIC8vcnVudGltZVxyXG5cdFx0XHRzdGFydFRpbWU7XHJcblxyXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZSA9PiB7XHJcblx0XHRcdGxldCB0b3VjaG9iaiA9IGUuY2hhbmdlZFRvdWNoZXNbMF07XHJcblx0XHRcdHN0YXJ0WCA9IHRvdWNob2JqLnBhZ2VYO1xyXG5cdFx0XHRzdGFydFkgPSB0b3VjaG9iai5wYWdlWTtcclxuXHRcdFx0c3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7IC8vdGltZSB0b3VjaCB3aXRoIHNlbnNvclxyXG5cdFx0fSk7XHJcblxyXG5cdFx0Ly9kaXNhYmxlIHRvdWNobW92ZVxyXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBlID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcblxyXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGUgPT4ge1xyXG5cdFx0XHRsZXQgdG91Y2hvYmogPSBlLmNoYW5nZWRUb3VjaGVzWzBdO1xyXG5cdFx0XHRkaXN0WCA9IHRvdWNob2JqLnBhZ2VYIC0gc3RhcnRYOyAvL2dldCBob3Jpem9udGFsIG1vdmVcclxuXHRcdFx0ZGlzdFkgPSB0b3VjaG9iai5wYWdlWSAtIHN0YXJ0WTsgLy9nZXQgdmVydGljYWwgbW92ZVxyXG5cdFx0XHRlbGFwc2VkVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gc3RhcnRUaW1lO1xyXG5cdFx0XHRpZiAoZWxhcHNlZFRpbWUgPD0gYWxsb3dlZFRpbWUpIHtcclxuXHRcdFx0XHRpZiAoTWF0aC5hYnMoZGlzdFkpID49IHRocmVzaG9sZCAmJiBNYXRoLmFicyhkaXN0WCkgPD0gZGV2aWF0aW9uKSB7IC8vdmVydGljYWwgc3dpcGVcclxuXHRcdFx0XHRcdHN3aXBlZGlyID0gKGRpc3RZIDwgMCkgPyBfc2xpZGVUb1NlY3Rpb24oY3VycmVudFNlY3Rpb24gKyAxKSA6IF9zbGlkZVRvU2VjdGlvbihjdXJyZW50U2VjdGlvbiAtIDEpXHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cclxuXHRsZXQgX3NsaWRlVG9TZWN0aW9uID0gKGluZGV4U2VjdGlvbikgPT4ge1xyXG5cdFx0aWYgKCFzY3JvbGwpIHtcclxuXHRcdFx0aWYgKGluZGV4U2VjdGlvbiA+PSAwICYmIGluZGV4U2VjdGlvbiA8IGNvdW50U2VjdGlvbnMpIHtcclxuXHRcdFx0XHRjdXJyZW50U2VjdGlvbiA9IGluZGV4U2VjdGlvbjtcclxuXHJcblx0XHRcdFx0c2Nyb2xsID0gdHJ1ZTtcclxuXHJcblx0XHRcdFx0bGV0IHBvc2l0aW9uID0gaW5kZXhTZWN0aW9uICogLTEwMCArICclJztcclxuXHJcblx0XHRcdFx0Y29udGVudC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSlgO1xyXG5cdFx0XHRcdGNvbnRlbnQuc3R5bGUud2Via2l0VHJhbnNmb3JtID0gYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0pYDtcclxuXHJcblx0XHRcdFx0bGV0IHNpZGVOYXZFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgb3B0aW9ucy5zaWRlTmF2aWdhdGlvbik7XHJcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBzaWRlTmF2RWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdGlmIChpICE9IGluZGV4U2VjdGlvbikge1xyXG5cdFx0XHRcdFx0XHRzaWRlTmF2RWxlbWVudHNbaV0uY2xhc3NMaXN0LnJlbW92ZShvcHRpb25zLnNpZGVOYXZpZ2F0aW9uICsgJy0tYWN0aXZlJyk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRzaWRlTmF2RWxlbWVudHNbaV0uY2xhc3NMaXN0LmFkZChvcHRpb25zLnNpZGVOYXZpZ2F0aW9uICsgJy0tYWN0aXZlJyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcclxuXHRcdFx0XHRcdHNjcm9sbCA9IGZhbHNlO1xyXG5cdFx0XHRcdH0sIDEzMDApO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0Ly9oYW5kbGVycyBmb3Iga2V5Ym9hcmRcclxuXHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZSA9PiB7XHJcblx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG5cdFx0XHRjYXNlIDQwOiAvL2Rvd25cclxuXHRcdFx0XHRfc2xpZGVUb1NlY3Rpb24oY3VycmVudFNlY3Rpb24gKyAxKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAzODogLy91cFxyXG5cdFx0XHRcdF9zbGlkZVRvU2VjdGlvbihjdXJyZW50U2VjdGlvbiAtIDEpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHQvL2hhbmRsZXJzIGZvciBsaW5rc1xyXG5cdGxpc3RMaW5rcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG5cdFx0aXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdGxldCBpbmRleCA9IHBhcnNlSW50KChlLnRhcmdldCkuZ2V0QXR0cmlidXRlKG9wdGlvbnMuYXR0cmlidXRlKSk7XHJcblx0XHRcdC8vZml4IGZvciBidXR0b24tZG93blxyXG5cdFx0XHRpZiAoIShpbmRleCA+PSAwKSkge1xyXG5cdFx0XHRcdGluZGV4ID0gcGFyc2VJbnQoKGUuY3VycmVudFRhcmdldCkuZ2V0QXR0cmlidXRlKG9wdGlvbnMuYXR0cmlidXRlKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0X3NsaWRlVG9TZWN0aW9uKGluZGV4KTtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG5cclxuXHQvL2hhbmRsZXJzIGZvciB3aGVlbFxyXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgZSA9PiB7XHJcblx0XHRsZXQgZGVsdGFZID0gZS5kZWx0YVk7XHJcblxyXG5cdFx0bGV0IGluZGV4ID0gZGVsdGFZID4gMCA/IGN1cnJlbnRTZWN0aW9uICsgMSA6IGN1cnJlbnRTZWN0aW9uIC0gMTtcclxuXHJcblx0XHRfc2xpZGVUb1NlY3Rpb24oaW5kZXgpO1xyXG5cdH0pO1xyXG5cclxuXHQvL2hhbmRsZXJzIGZvciBzd2lwZVxyXG5cdGlmIChjaGVja01vYmlsZSkge1xyXG5cdFx0X3N3aXBlRGV0ZWN0ZWQoY29udGVudCk7XHJcblx0fVxyXG59O1xyXG5cclxuT25lUGFnZVNjcm9sbCh7XHJcblx0Y29udGVudDogJ2NvbnRlbnQnLFxyXG5cdHNlY3Rpb246ICdzZWN0aW9uJyxcclxuXHRzaWRlTmF2aWdhdGlvbjogJ3NpZGUtbmF2aWdhdGlvbl9faXRlbScsXHJcblx0YXR0cmlidXRlOiAnZGF0YS1zY3JvbGwtdG8nXHJcbn0pO1xyXG5cclxuLyogc2xpZGVyICovXHJcbmxldCBzbGlkZXIgPSBvcHRpb25zID0+IHtcclxuXHRsZXQgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMud3JhcHBlcik7XHJcblx0bGV0IHdpZHRoV3JhcHBlciA9IHdyYXBwZXIuY2xpZW50V2lkdGg7XHJcblx0d3JhcHBlci5zdHlsZS53aWR0aCA9IHdpZHRoV3JhcHBlciAgKyAncHgnO1xyXG5cclxuXHRsZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMubGlzdCk7XHJcblx0bGV0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicrb3B0aW9ucy5pdGVtKTtcclxuXHJcblx0bGV0IGxlZnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJytvcHRpb25zLnByZXYpO1xyXG5cdGxldCByaWdodCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMubmV4dCk7XHJcblxyXG5cdGl0ZW1zLmZvckVhY2goZWxlbWVudCA9PiB7XHJcblx0XHRlbGVtZW50LnN0eWxlLndpZHRoID0gd2lkdGhXcmFwcGVyICArICdweCc7XHJcblx0fSk7XHJcblxyXG5cdGxldCBtaW5SaWdodCA9IDA7XHJcblx0bGV0IG1heFJpZ2h0ID0gd2lkdGhXcmFwcGVyICogKGl0ZW1zLmxlbmd0aCAtIDEpO1xyXG5cdGxldCBzdGVwID0gd2lkdGhXcmFwcGVyO1xyXG5cdGxldCBjdXJyZW50UmlnaHQgPSAwO1xyXG5cclxuXHRsZXQgX3NsaWRlUmlnaHQgPSB2YWx1ZSA9PiB7XHJcblx0XHRpZiAodmFsdWUgPD0gbWF4UmlnaHQpIHtcclxuXHRcdFx0Y3VycmVudFJpZ2h0ICs9IHN0ZXA7XHJcblx0XHRcdGxpc3Quc3R5bGUucmlnaHQgPSBjdXJyZW50UmlnaHQgKyBcInB4XCI7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IF9zbGlkZUxlZnQgPSB2YWx1ZSA9PiB7XHJcblx0XHRpZiAodmFsdWUgPj0gbWluUmlnaHQpIHtcclxuXHRcdFx0Y3VycmVudFJpZ2h0IC09IHN0ZXA7XHJcblx0XHRcdGxpc3Quc3R5bGUucmlnaHQgPSBjdXJyZW50UmlnaHQgKyBcInB4XCI7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IGluaXRpYWwgPSAoKSA9PiB7XHJcblx0XHRsaXN0LnN0eWxlLnJpZ2h0ID0gY3VycmVudFJpZ2h0O1xyXG5cclxuXHRcdHJpZ2h0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0X3NsaWRlUmlnaHQoY3VycmVudFJpZ2h0ICsgc3RlcCk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRsZWZ0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0X3NsaWRlTGVmdChjdXJyZW50UmlnaHQgLSBzdGVwKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdF9zd2lwZURldGVjdGVkKHdyYXBwZXIpO1xyXG5cdH07XHJcblxyXG5cdGxldCBfc3dpcGVEZXRlY3RlZCA9IGVsZW1lbnQgPT4ge1xyXG5cdFx0bGV0IHN0YXJ0WCxcclxuXHRcdFx0c3RhcnRZLFxyXG5cdFx0XHRkaXN0WCxcclxuXHRcdFx0ZGlzdFksXHJcblx0XHRcdGRldmlhdGlvbiA9IDIwMCwgLy9kZXZpYXRpb24gZnJvbSBtYWluIGRpcmVjdGlvblxyXG5cdFx0XHR0aHJlc2hvbGQgPSAxNTAsIC8vbWluIHJhbmdlIGZvciBzd2lwZVxyXG5cdFx0XHRhbGxvd2VkVGltZSA9IDEwMDAsIC8vbWF4IHRpbWUgZm9yIHJhbmdlXHJcblx0XHRcdGVsYXBzZWRUaW1lLCAvL3J1bnRpbWVcclxuXHRcdFx0c3RhcnRUaW1lO1xyXG5cclxuXHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGUgPT4ge1xyXG5cdFx0XHRsZXQgdG91Y2hvYmogPSBlLmNoYW5nZWRUb3VjaGVzWzBdO1xyXG5cdFx0XHRzdGFydFggPSB0b3VjaG9iai5wYWdlWDtcclxuXHRcdFx0c3RhcnRZID0gdG91Y2hvYmoucGFnZVk7XHJcblx0XHRcdHN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOyAvL3RpbWUgdG91Y2ggd2l0aCBzZW5zb3JcclxuXHRcdH0pO1xyXG5cclxuXHRcdC8vZGlzYWJsZSB0b3VjaG1vdmVcclxuXHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgZSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xyXG5cclxuXHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBlID0+IHtcclxuXHRcdFx0bGV0IHRvdWNob2JqID0gZS5jaGFuZ2VkVG91Y2hlc1swXTtcclxuXHRcdFx0ZGlzdFggPSB0b3VjaG9iai5wYWdlWCAtIHN0YXJ0WDsgLy9nZXQgaG9yaXpvbnRhbCBtb3ZlXHJcblx0XHRcdGRpc3RZID0gdG91Y2hvYmoucGFnZVkgLSBzdGFydFk7IC8vZ2V0IHZlcnRpY2FsIG1vdmVcclxuXHRcdFx0ZWxhcHNlZFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHN0YXJ0VGltZTtcclxuXHRcdFx0aWYgKGVsYXBzZWRUaW1lIDw9IGFsbG93ZWRUaW1lKSB7XHJcblx0XHRcdFx0aWYgKE1hdGguYWJzKGRpc3RYKSA+PSB0aHJlc2hvbGQgJiYgTWF0aC5hYnMoZGlzdFkpIDw9IGRldmlhdGlvbikgeyAvL2hvcml6b250YWwgc3dpcGVcclxuXHRcdFx0XHRcdHN3aXBlZGlyID0gKGRpc3RYIDwgMCkgPyBfc2xpZGVSaWdodChjdXJyZW50UmlnaHQgKyBzdGVwKSA6IF9zbGlkZUxlZnQoY3VycmVudFJpZ2h0IC0gc3RlcClcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdGxldCBfbW9iaWxlSW5ncmVkaWVudHMgPSAoKSA9PiB7XHJcblx0XHRsZXQgYnRuSW5ncmVkaWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnVyZ2VyX19pbmdyZWRpZW50cycpO1xyXG5cdFx0bGV0IGJ0bkNsb3NlSW5ncmVkaWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZHJvcGRvd25fX2Nsb3NlJyk7XHJcblxyXG5cdFx0YnRuQ2xvc2VJbmdyZWRpZW50cy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0XHRidG5JbmdyZWRpZW50cy5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuXHRcdH0pO1xyXG5cdFx0YnRuQ2xvc2VJbmdyZWRpZW50cy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRcdGJ0bkluZ3JlZGllbnRzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0aWYgKGNoZWNrTW9iaWxlKSB7XHJcblx0XHRcdGJ0bkluZ3JlZGllbnRzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdFx0YnRuSW5ncmVkaWVudHMuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRidG5JbmdyZWRpZW50cy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgZSA9PiB7XHJcblx0XHRcdGJ0bkluZ3JlZGllbnRzLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XHJcblx0XHR9KTtcclxuXHJcblx0XHRidG5JbmdyZWRpZW50cy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgZSA9PiB7XHJcblx0XHRcdGJ0bkluZ3JlZGllbnRzLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XHJcblx0XHR9KTtcclxuXHR9O1xyXG5cdF9tb2JpbGVJbmdyZWRpZW50cygpO1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogaW5pdGlhbFxyXG5cdH1cclxufTtcclxuXHJcbnNsaWRlcih7XHJcblx0d3JhcHBlcjogJ2J1cmdlcl9fd3JhcHBlcicsXHJcblx0bGlzdDogJ2J1cmdlcl9fbGlzdCcsXHJcblx0aXRlbTogJ2J1cmdlcl9faXRlbScsXHJcblx0bmV4dDogJ2J1cmdlcl9fY29udHJvbHMtbGluay0tbmV4dCcsXHJcblx0cHJldjogJ2J1cmdlcl9fY29udHJvbHMtbGluay0tcHJldidcclxufSkuaW5pdCgpOyJdfQ==
