/* Hamburger menu */
let hamburger = options => {
	let button = document.querySelector(options.button);
	let menu = document.querySelector(options.menu);
	let list = document.querySelector(".mobile-menu__list");

	let _openMenu = e => {
		e.preventDefault();

		menu.classList.toggle("active");
		document.body.classList.toggle("lock");
	};

	let _closeMenu = e => {
		e.preventDefault();

		if (e.target.className == "mobile-menu__link") {
			menu.classList.remove("active");
			document.body.classList.remove("lock");
		}
	};

	let addListeners = () => {
		button.addEventListener("click", _openMenu);
		list.addEventListener("click", _closeMenu);
	};

	return {
		init: addListeners
	};
};

hamburger({
	button: ".hamburger-menu-btn",
	menu: ".mobile-menu"
}).init();

/* Vertical Accordeon */
// let verticalAccordeon = (function (options) {
// 	let list = document.querySelector(options.listSelector);
// 	let itemsList = list.querySelectorAll('.accordeon__item');
//
// 	let _getHeight = function _getHeight(elem) {
// 		let height = elem.scrollHeight + 'px';
// 		return height;
// 	};
//
// 	let _toogleItems = function (e) {
// 		e.preventDefault();
//
// 		if (e.target.className == options.linkClass) {
// 			let item = e.target.parentNode;
// 			let contentItem = item.querySelector('.accordeon__item-content');
//
// 			if (!item.classList.contains(options.activeItemClass)) {
// 				_closeItems(itemsList);
// 				_openItem(item, contentItem);
// 			} else {
// 				_closeItem(item, contentItem);
// 			}
// 		}
// 	};
//
// 	let _openItem = function _openItem(item, contentItem) {
// 		let contentHeight = _getHeight(contentItem);
//
// 		item.classList.toggle(options.activeItemClass);
// 		contentItem.style.height = contentHeight;
// 	};
//
// 	let _closeItem = function _closeItem(item, contentItem) {
// 		contentItem.style.height = '';
// 		item.classList.remove(options.activeItemClass);
// 	};
//
// 	let _closeItems = function _closeItems(items) {
// 		for (let i = 0; i < items.length; i++) {
// 			let contentItem = items[i].querySelector('.accordeon__item-content');
// 			_closeItem(items[i], contentItem);
// 		}
// 	};
//
// 	let addListeners = function () {
// 		list.addEventListener('click', _toogleItems)
// 	};
//
// 	return {
// 		init: addListeners
// 	}
// })({
// 	listSelector: ".accordeon__list",
// 	linkClass: "accordeon__trigger",
// 	activeItemClass: "accordeon__item--active",
// });
//
// verticalAccordeon.init();

/* Horizontal Accordeon */
// let horizontalAccordeon = (function (options) {
// 	let list = document.querySelector('.'+options.list);
// 	let itemsList = list.querySelectorAll('.'+options.item);
//
// 	/* calculate needed width */
// 	let userWidth = window.innerWidth;
// 	let titleItem = list.querySelector('.'+options.link);
// 	let widthTitle = titleItem.clientWidth;
// 	let neededWidth = userWidth - itemsList.length * widthTitle;
// 	console.log(neededWidth);
// 	neededWidth = (neededWidth > 520) ? 520 : neededWidth;
//
// 	let _toogleItems = function (e) {
// 		e.preventDefault();
//
// 		if (e.target.className == options.link) {
// 			let item = e.target.parentNode;
// 			let contentItem = item.querySelector('.'+options.content);
//
// 			if (!item.classList.contains(options.activeItem)) {
// 				_closeItems(itemsList);
// 				_openItem(item, contentItem);
// 			} else {
// 				_closeItem(item, contentItem);
// 			}
// 		}
// 	};
//
// 	let _openItem = function _openItem(item, contentItem) {
// 		item.classList.toggle(options.activeItem);
// 		contentItem.style.width = neededWidth + 'px';
// 	};
//
// 	let _closeItem = function _closeItem(item, contentItem) {
// 		contentItem.style.width = '';
// 		item.classList.remove(options.activeItem);
// 	};
//
// 	let _closeItems = function _closeItems(items) {
// 		for (let i = 0; i < items.length; i++) {
// 			let contentItem = items[i].querySelector('.'+options.content);
// 			_closeItem(items[i], contentItem);
// 		}
// 	};
//
// 	let addListeners = function () {
// 		list.addEventListener('click', _toogleItems)
// 	};
//
// 	return {
// 		init: addListeners
// 	}
// })({
// 	list: "menu-accordeon__list",
// 	item: "menu-accordeon__item",
// 	activeItem: "menu-accordeon__item--active",
// 	link: "menu-accordeon__trigger",
// 	content: "menu-accordeon__item-content"
// });
//
// horizontalAccordeon.init();

/* Multi-accordeon */
let multiAcco = options => {
	let list = document.querySelector('.' + options.list);
	let itemsList = list.querySelectorAll('.' + options.item);

	if (options.direction == "horizontal") {
		/* for calculate needed width */
		let userWidth = window.innerWidth;
		let titleItem = list.querySelector('.' + options.link);
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
	} else if (options.direction == "vertical") {
		/* for calculate needed height */
		var _getHeight = elem => elem.scrollHeight + 'px';
	}

	let _toogleItems = e => {
		e.preventDefault();

		if (e.target.className == options.link) {
			let item = e.target.parentNode;
			let contentItem = item.querySelector('.' + options.content);

			if (!item.classList.contains(options.activeItem)) {
				_closeItems(itemsList);
				_openItem(item, contentItem);
			} else {
				_closeItem(item, contentItem);
			}
		}
	};

	let _openItem = (item, contentItem) => {
		if (options.direction == "horizontal") {
			contentItem.style.width = neededWidth;
		} else if (options.direction == "vertical") {
			let contentHeight = _getHeight(contentItem);
			contentItem.style.height = contentHeight;
		}
		item.classList.toggle(options.activeItem);
	};

	let _closeItem = (item, contentItem) => {
		if (options.direction == "horizontal") {
			contentItem.style.width = '';
		} else if (options.direction == "vertical") {
			contentItem.style.height = '';
		}

		item.classList.remove(options.activeItem);
	};

	let _closeItems = items => {
		for (let i = 0; i < items.length; i++) {
			let contentItem = items[i].querySelector('.' + options.content);
			_closeItem(items[i], contentItem);
		}
	};

	let addListeners = () => {
		list.addEventListener('click', _toogleItems)
	};

	return {
		init: addListeners
	}
};

multiAcco({
	direction: "horizontal",
	list: "menu-accordeon__list",
	item: "menu-accordeon__item",
	activeItem: "menu-accordeon__item--active",
	link: "menu-accordeon__trigger",
	content: "menu-accordeon__item-content"
}).init();

multiAcco({
	direction: "vertical",
	list: "accordeon__list",
	item: "accordeon__item",
	activeItem: "accordeon__item--active",
	link: "accordeon__trigger",
	content: "accordeon__item-content"
}).init();

/* popup */
let popup = options => {
	let wrapper = document.querySelector('.' + options.wrapper);

	let _tooglePopup = e => {
		e.preventDefault();

		if (e.target.className == options.btn) {
			_openPopup(e.target);
		}
	};

	let _openPopup = btn => {
		let overlayElement = document.createElement('div');
		overlayElement.classList.add('overlay');

		let popupElement = document.createElement('div');
		popupElement.classList.add('popup');

		let contentElement = document.createElement('div');
		contentElement.classList.add('popup__content');

		let content = btn.parentNode;

		let text = content
			.querySelector('.' + options.text)
			.textContent;
		contentElement.innerHTML = text;

		let titleElement = document.createElement('div');
		titleElement.classList.add('popup__title');

		let title = content
			.querySelector('.' + options.title)
			.textContent;
		titleElement.innerHTML = title;

		let closeElement = document.createElement("a");
		closeElement.classList.add("popup__close");
		closeElement.innerHTML = '<svg class="popup__close-picture"><use xlink:href="./img/icons/mysprite.svg#close"></use></svg>';
		closeElement.href = "#";
		closeElement.addEventListener("click", e => {
			e.preventDefault();
			_closePopup(overlayElement);
		});

		overlayElement.appendChild(popupElement);
		popupElement.appendChild(titleElement);
		popupElement.appendChild(contentElement);
		popupElement.appendChild(closeElement);

		document.body.appendChild(overlayElement);
	};

	let _closePopup = overlay => {
		document.body.removeChild(overlay);
	};

	let addListeners = () => {
		wrapper.addEventListener('click', _tooglePopup)
	};

	return {
		init: addListeners
	}
};

popup({
	wrapper: "reviews__list",
	btn: "reviews__button",
	title: "reviews__title",
	text: "reviews__text"
}).init();

/* One Page Scroll */

let OnePageScroll = options => {
	let currentSection = 0;
	let content = document.querySelector('.'+options.content);
	let countSections = document.querySelectorAll('.'+options.section).length;
	let listLinks = document.querySelectorAll('['+options.attribute+']');
	let scroll = false;

	let _slideToSection = (indexSection) => {
		if (!scroll) {
			if (indexSection >= 0 && indexSection < countSections) {
				currentSection = indexSection;

				scroll = true;

				let position = indexSection * -100 + '%';

				content.style.transform = `translateY(${position})`;
				content.style.webkitTransform = `translateY(${position})`;

				let sideNavElements = document.querySelectorAll('.' + options.sideNavigation);
				for (let i = 0; i < sideNavElements.length; i++) {
					if (i != indexSection) {
						sideNavElements[i].classList.remove(options.sideNavigation + '--active');
					} else {
						sideNavElements[i].classList.add(options.sideNavigation + '--active');
					}
				}

				setTimeout(() => {
					scroll = false;
				}, 1300);
			}
		}
	};

	//handlers for keyboard
	document.addEventListener('keydown', e => {
		switch (e.keyCode) {
			case 40: //down
				_slideToSection(currentSection + 1);
				break;
			case 38: //up
				_slideToSection(currentSection - 1);
				break;
		}
	});

	//handlers for links
	listLinks.forEach(item => {
		item.addEventListener('click', e => {
			e.preventDefault();
			let index = parseInt((e.target).getAttribute(options.attribute));
			//fix for button-down
			if (!(index >= 0)) {
				index = parseInt((e.currentTarget).getAttribute(options.attribute));
			}
			_slideToSection(index);
		});
	});

	//handlers for wheel
	document.addEventListener('wheel', e => {
		let deltaY = e.deltaY;

		let index = deltaY > 0 ? currentSection + 1: currentSection - 1;

		_slideToSection(index);
	});
};

OnePageScroll({
	content: 'content',
	section: 'section',
	sideNavigation: 'side-navigation__item',
	attribute: 'data-scroll-to'
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIEhhbWJ1cmdlciBtZW51ICovXHJcbmxldCBoYW1idXJnZXIgPSBvcHRpb25zID0+IHtcclxuXHRsZXQgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmJ1dHRvbik7XHJcblx0bGV0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubWVudSk7XHJcblx0bGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vYmlsZS1tZW51X19saXN0XCIpO1xyXG5cclxuXHRsZXQgX29wZW5NZW51ID0gZSA9PiB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0bWVudS5jbGFzc0xpc3QudG9nZ2xlKFwiYWN0aXZlXCIpO1xyXG5cdFx0ZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudG9nZ2xlKFwibG9ja1wiKTtcclxuXHR9O1xyXG5cclxuXHRsZXQgX2Nsb3NlTWVudSA9IGUgPT4ge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gXCJtb2JpbGUtbWVudV9fbGlua1wiKSB7XHJcblx0XHRcdG1lbnUuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcclxuXHRcdFx0ZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKFwibG9ja1wiKTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXJzID0gKCkgPT4ge1xyXG5cdFx0YnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBfb3Blbk1lbnUpO1xyXG5cdFx0bGlzdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgX2Nsb3NlTWVudSk7XHJcblx0fTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG5cdH07XHJcbn07XHJcblxyXG5oYW1idXJnZXIoe1xyXG5cdGJ1dHRvbjogXCIuaGFtYnVyZ2VyLW1lbnUtYnRuXCIsXHJcblx0bWVudTogXCIubW9iaWxlLW1lbnVcIlxyXG59KS5pbml0KCk7XHJcblxyXG4vKiBWZXJ0aWNhbCBBY2NvcmRlb24gKi9cclxuLy8gbGV0IHZlcnRpY2FsQWNjb3JkZW9uID0gKGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbi8vIFx0bGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubGlzdFNlbGVjdG9yKTtcclxuLy8gXHRsZXQgaXRlbXNMaXN0ID0gbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkZW9uX19pdGVtJyk7XHJcbi8vXHJcbi8vIFx0bGV0IF9nZXRIZWlnaHQgPSBmdW5jdGlvbiBfZ2V0SGVpZ2h0KGVsZW0pIHtcclxuLy8gXHRcdGxldCBoZWlnaHQgPSBlbGVtLnNjcm9sbEhlaWdodCArICdweCc7XHJcbi8vIFx0XHRyZXR1cm4gaGVpZ2h0O1xyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IF90b29nbGVJdGVtcyA9IGZ1bmN0aW9uIChlKSB7XHJcbi8vIFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcbi8vXHJcbi8vIFx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IG9wdGlvbnMubGlua0NsYXNzKSB7XHJcbi8vIFx0XHRcdGxldCBpdGVtID0gZS50YXJnZXQucGFyZW50Tm9kZTtcclxuLy8gXHRcdFx0bGV0IGNvbnRlbnRJdGVtID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uX19pdGVtLWNvbnRlbnQnKTtcclxuLy9cclxuLy8gXHRcdFx0aWYgKCFpdGVtLmNsYXNzTGlzdC5jb250YWlucyhvcHRpb25zLmFjdGl2ZUl0ZW1DbGFzcykpIHtcclxuLy8gXHRcdFx0XHRfY2xvc2VJdGVtcyhpdGVtc0xpc3QpO1xyXG4vLyBcdFx0XHRcdF9vcGVuSXRlbShpdGVtLCBjb250ZW50SXRlbSk7XHJcbi8vIFx0XHRcdH0gZWxzZSB7XHJcbi8vIFx0XHRcdFx0X2Nsb3NlSXRlbShpdGVtLCBjb250ZW50SXRlbSk7XHJcbi8vIFx0XHRcdH1cclxuLy8gXHRcdH1cclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBfb3Blbkl0ZW0gPSBmdW5jdGlvbiBfb3Blbkl0ZW0oaXRlbSwgY29udGVudEl0ZW0pIHtcclxuLy8gXHRcdGxldCBjb250ZW50SGVpZ2h0ID0gX2dldEhlaWdodChjb250ZW50SXRlbSk7XHJcbi8vXHJcbi8vIFx0XHRpdGVtLmNsYXNzTGlzdC50b2dnbGUob3B0aW9ucy5hY3RpdmVJdGVtQ2xhc3MpO1xyXG4vLyBcdFx0Y29udGVudEl0ZW0uc3R5bGUuaGVpZ2h0ID0gY29udGVudEhlaWdodDtcclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBfY2xvc2VJdGVtID0gZnVuY3Rpb24gX2Nsb3NlSXRlbShpdGVtLCBjb250ZW50SXRlbSkge1xyXG4vLyBcdFx0Y29udGVudEl0ZW0uc3R5bGUuaGVpZ2h0ID0gJyc7XHJcbi8vIFx0XHRpdGVtLmNsYXNzTGlzdC5yZW1vdmUob3B0aW9ucy5hY3RpdmVJdGVtQ2xhc3MpO1xyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IF9jbG9zZUl0ZW1zID0gZnVuY3Rpb24gX2Nsb3NlSXRlbXMoaXRlbXMpIHtcclxuLy8gXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuLy8gXHRcdFx0bGV0IGNvbnRlbnRJdGVtID0gaXRlbXNbaV0ucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbl9faXRlbS1jb250ZW50Jyk7XHJcbi8vIFx0XHRcdF9jbG9zZUl0ZW0oaXRlbXNbaV0sIGNvbnRlbnRJdGVtKTtcclxuLy8gXHRcdH1cclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBhZGRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XHJcbi8vIFx0XHRsaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3Rvb2dsZUl0ZW1zKVxyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0cmV0dXJuIHtcclxuLy8gXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG4vLyBcdH1cclxuLy8gfSkoe1xyXG4vLyBcdGxpc3RTZWxlY3RvcjogXCIuYWNjb3JkZW9uX19saXN0XCIsXHJcbi8vIFx0bGlua0NsYXNzOiBcImFjY29yZGVvbl9fdHJpZ2dlclwiLFxyXG4vLyBcdGFjdGl2ZUl0ZW1DbGFzczogXCJhY2NvcmRlb25fX2l0ZW0tLWFjdGl2ZVwiLFxyXG4vLyB9KTtcclxuLy9cclxuLy8gdmVydGljYWxBY2NvcmRlb24uaW5pdCgpO1xyXG5cclxuLyogSG9yaXpvbnRhbCBBY2NvcmRlb24gKi9cclxuLy8gbGV0IGhvcml6b250YWxBY2NvcmRlb24gPSAoZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuLy8gXHRsZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMubGlzdCk7XHJcbi8vIFx0bGV0IGl0ZW1zTGlzdCA9IGxpc3QucXVlcnlTZWxlY3RvckFsbCgnLicrb3B0aW9ucy5pdGVtKTtcclxuLy9cclxuLy8gXHQvKiBjYWxjdWxhdGUgbmVlZGVkIHdpZHRoICovXHJcbi8vIFx0bGV0IHVzZXJXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4vLyBcdGxldCB0aXRsZUl0ZW0gPSBsaXN0LnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMubGluayk7XHJcbi8vIFx0bGV0IHdpZHRoVGl0bGUgPSB0aXRsZUl0ZW0uY2xpZW50V2lkdGg7XHJcbi8vIFx0bGV0IG5lZWRlZFdpZHRoID0gdXNlcldpZHRoIC0gaXRlbXNMaXN0Lmxlbmd0aCAqIHdpZHRoVGl0bGU7XHJcbi8vIFx0Y29uc29sZS5sb2cobmVlZGVkV2lkdGgpO1xyXG4vLyBcdG5lZWRlZFdpZHRoID0gKG5lZWRlZFdpZHRoID4gNTIwKSA/IDUyMCA6IG5lZWRlZFdpZHRoO1xyXG4vL1xyXG4vLyBcdGxldCBfdG9vZ2xlSXRlbXMgPSBmdW5jdGlvbiAoZSkge1xyXG4vLyBcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vL1xyXG4vLyBcdFx0aWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBvcHRpb25zLmxpbmspIHtcclxuLy8gXHRcdFx0bGV0IGl0ZW0gPSBlLnRhcmdldC5wYXJlbnROb2RlO1xyXG4vLyBcdFx0XHRsZXQgY29udGVudEl0ZW0gPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMuY29udGVudCk7XHJcbi8vXHJcbi8vIFx0XHRcdGlmICghaXRlbS5jbGFzc0xpc3QuY29udGFpbnMob3B0aW9ucy5hY3RpdmVJdGVtKSkge1xyXG4vLyBcdFx0XHRcdF9jbG9zZUl0ZW1zKGl0ZW1zTGlzdCk7XHJcbi8vIFx0XHRcdFx0X29wZW5JdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKTtcclxuLy8gXHRcdFx0fSBlbHNlIHtcclxuLy8gXHRcdFx0XHRfY2xvc2VJdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKTtcclxuLy8gXHRcdFx0fVxyXG4vLyBcdFx0fVxyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IF9vcGVuSXRlbSA9IGZ1bmN0aW9uIF9vcGVuSXRlbShpdGVtLCBjb250ZW50SXRlbSkge1xyXG4vLyBcdFx0aXRlbS5jbGFzc0xpc3QudG9nZ2xlKG9wdGlvbnMuYWN0aXZlSXRlbSk7XHJcbi8vIFx0XHRjb250ZW50SXRlbS5zdHlsZS53aWR0aCA9IG5lZWRlZFdpZHRoICsgJ3B4JztcclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBfY2xvc2VJdGVtID0gZnVuY3Rpb24gX2Nsb3NlSXRlbShpdGVtLCBjb250ZW50SXRlbSkge1xyXG4vLyBcdFx0Y29udGVudEl0ZW0uc3R5bGUud2lkdGggPSAnJztcclxuLy8gXHRcdGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShvcHRpb25zLmFjdGl2ZUl0ZW0pO1xyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IF9jbG9zZUl0ZW1zID0gZnVuY3Rpb24gX2Nsb3NlSXRlbXMoaXRlbXMpIHtcclxuLy8gXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuLy8gXHRcdFx0bGV0IGNvbnRlbnRJdGVtID0gaXRlbXNbaV0ucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy5jb250ZW50KTtcclxuLy8gXHRcdFx0X2Nsb3NlSXRlbShpdGVtc1tpXSwgY29udGVudEl0ZW0pO1xyXG4vLyBcdFx0fVxyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0bGV0IGFkZExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcclxuLy8gXHRcdGxpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9vZ2xlSXRlbXMpXHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRyZXR1cm4ge1xyXG4vLyBcdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcbi8vIFx0fVxyXG4vLyB9KSh7XHJcbi8vIFx0bGlzdDogXCJtZW51LWFjY29yZGVvbl9fbGlzdFwiLFxyXG4vLyBcdGl0ZW06IFwibWVudS1hY2NvcmRlb25fX2l0ZW1cIixcclxuLy8gXHRhY3RpdmVJdGVtOiBcIm1lbnUtYWNjb3JkZW9uX19pdGVtLS1hY3RpdmVcIixcclxuLy8gXHRsaW5rOiBcIm1lbnUtYWNjb3JkZW9uX190cmlnZ2VyXCIsXHJcbi8vIFx0Y29udGVudDogXCJtZW51LWFjY29yZGVvbl9faXRlbS1jb250ZW50XCJcclxuLy8gfSk7XHJcbi8vXHJcbi8vIGhvcml6b250YWxBY2NvcmRlb24uaW5pdCgpO1xyXG5cclxuLyogTXVsdGktYWNjb3JkZW9uICovXHJcbmxldCBtdWx0aUFjY28gPSBvcHRpb25zID0+IHtcclxuXHRsZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy5saXN0KTtcclxuXHRsZXQgaXRlbXNMaXN0ID0gbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIG9wdGlvbnMuaXRlbSk7XHJcblxyXG5cdGlmIChvcHRpb25zLmRpcmVjdGlvbiA9PSBcImhvcml6b250YWxcIikge1xyXG5cdFx0LyogZm9yIGNhbGN1bGF0ZSBuZWVkZWQgd2lkdGggKi9cclxuXHRcdGxldCB1c2VyV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuXHRcdGxldCB0aXRsZUl0ZW0gPSBsaXN0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy5saW5rKTtcclxuXHRcdGxldCB3aWR0aFRpdGxlID0gdGl0bGVJdGVtLmNsaWVudFdpZHRoO1xyXG5cdFx0dmFyIG5lZWRlZFdpZHRoID0gdXNlcldpZHRoIC0gaXRlbXNMaXN0Lmxlbmd0aCAqIHdpZHRoVGl0bGU7XHJcblx0XHRuZWVkZWRXaWR0aCA9IChuZWVkZWRXaWR0aCA+IDUyMCkgPyAnNTIwcHgnIDogbmVlZGVkV2lkdGggKyAncHgnO1xyXG5cdH0gZWxzZSBpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT0gXCJ2ZXJ0aWNhbFwiKSB7XHJcblx0XHQvKiBmb3IgY2FsY3VsYXRlIG5lZWRlZCBoZWlnaHQgKi9cclxuXHRcdHZhciBfZ2V0SGVpZ2h0ID0gZWxlbSA9PiBlbGVtLnNjcm9sbEhlaWdodCArICdweCc7XHJcblx0fVxyXG5cclxuXHRsZXQgX3Rvb2dsZUl0ZW1zID0gZSA9PiB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0aWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBvcHRpb25zLmxpbmspIHtcclxuXHRcdFx0bGV0IGl0ZW0gPSBlLnRhcmdldC5wYXJlbnROb2RlO1xyXG5cdFx0XHRsZXQgY29udGVudEl0ZW0gPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy5jb250ZW50KTtcclxuXHJcblx0XHRcdGlmICghaXRlbS5jbGFzc0xpc3QuY29udGFpbnMob3B0aW9ucy5hY3RpdmVJdGVtKSkge1xyXG5cdFx0XHRcdF9jbG9zZUl0ZW1zKGl0ZW1zTGlzdCk7XHJcblx0XHRcdFx0X29wZW5JdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRfY2xvc2VJdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCBfb3Blbkl0ZW0gPSAoaXRlbSwgY29udGVudEl0ZW0pID0+IHtcclxuXHRcdGlmIChvcHRpb25zLmRpcmVjdGlvbiA9PSBcImhvcml6b250YWxcIikge1xyXG5cdFx0XHRjb250ZW50SXRlbS5zdHlsZS53aWR0aCA9IG5lZWRlZFdpZHRoO1xyXG5cdFx0fSBlbHNlIGlmIChvcHRpb25zLmRpcmVjdGlvbiA9PSBcInZlcnRpY2FsXCIpIHtcclxuXHRcdFx0bGV0IGNvbnRlbnRIZWlnaHQgPSBfZ2V0SGVpZ2h0KGNvbnRlbnRJdGVtKTtcclxuXHRcdFx0Y29udGVudEl0ZW0uc3R5bGUuaGVpZ2h0ID0gY29udGVudEhlaWdodDtcclxuXHRcdH1cclxuXHRcdGl0ZW0uY2xhc3NMaXN0LnRvZ2dsZShvcHRpb25zLmFjdGl2ZUl0ZW0pO1xyXG5cdH07XHJcblxyXG5cdGxldCBfY2xvc2VJdGVtID0gKGl0ZW0sIGNvbnRlbnRJdGVtKSA9PiB7XHJcblx0XHRpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT0gXCJob3Jpem9udGFsXCIpIHtcclxuXHRcdFx0Y29udGVudEl0ZW0uc3R5bGUud2lkdGggPSAnJztcclxuXHRcdH0gZWxzZSBpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT0gXCJ2ZXJ0aWNhbFwiKSB7XHJcblx0XHRcdGNvbnRlbnRJdGVtLnN0eWxlLmhlaWdodCA9ICcnO1xyXG5cdFx0fVxyXG5cclxuXHRcdGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShvcHRpb25zLmFjdGl2ZUl0ZW0pO1xyXG5cdH07XHJcblxyXG5cdGxldCBfY2xvc2VJdGVtcyA9IGl0ZW1zID0+IHtcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0bGV0IGNvbnRlbnRJdGVtID0gaXRlbXNbaV0ucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLmNvbnRlbnQpO1xyXG5cdFx0XHRfY2xvc2VJdGVtKGl0ZW1zW2ldLCBjb250ZW50SXRlbSk7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IGFkZExpc3RlbmVycyA9ICgpID0+IHtcclxuXHRcdGxpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9vZ2xlSXRlbXMpXHJcblx0fTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG5cdH1cclxufTtcclxuXHJcbm11bHRpQWNjbyh7XHJcblx0ZGlyZWN0aW9uOiBcImhvcml6b250YWxcIixcclxuXHRsaXN0OiBcIm1lbnUtYWNjb3JkZW9uX19saXN0XCIsXHJcblx0aXRlbTogXCJtZW51LWFjY29yZGVvbl9faXRlbVwiLFxyXG5cdGFjdGl2ZUl0ZW06IFwibWVudS1hY2NvcmRlb25fX2l0ZW0tLWFjdGl2ZVwiLFxyXG5cdGxpbms6IFwibWVudS1hY2NvcmRlb25fX3RyaWdnZXJcIixcclxuXHRjb250ZW50OiBcIm1lbnUtYWNjb3JkZW9uX19pdGVtLWNvbnRlbnRcIlxyXG59KS5pbml0KCk7XHJcblxyXG5tdWx0aUFjY28oe1xyXG5cdGRpcmVjdGlvbjogXCJ2ZXJ0aWNhbFwiLFxyXG5cdGxpc3Q6IFwiYWNjb3JkZW9uX19saXN0XCIsXHJcblx0aXRlbTogXCJhY2NvcmRlb25fX2l0ZW1cIixcclxuXHRhY3RpdmVJdGVtOiBcImFjY29yZGVvbl9faXRlbS0tYWN0aXZlXCIsXHJcblx0bGluazogXCJhY2NvcmRlb25fX3RyaWdnZXJcIixcclxuXHRjb250ZW50OiBcImFjY29yZGVvbl9faXRlbS1jb250ZW50XCJcclxufSkuaW5pdCgpO1xyXG5cclxuLyogcG9wdXAgKi9cclxubGV0IHBvcHVwID0gb3B0aW9ucyA9PiB7XHJcblx0bGV0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMud3JhcHBlcik7XHJcblxyXG5cdGxldCBfdG9vZ2xlUG9wdXAgPSBlID0+IHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IG9wdGlvbnMuYnRuKSB7XHJcblx0XHRcdF9vcGVuUG9wdXAoZS50YXJnZXQpO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCBfb3BlblBvcHVwID0gYnRuID0+IHtcclxuXHRcdGxldCBvdmVybGF5RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0b3ZlcmxheUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnb3ZlcmxheScpO1xyXG5cclxuXHRcdGxldCBwb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHBvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwb3B1cCcpO1xyXG5cclxuXHRcdGxldCBjb250ZW50RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0Y29udGVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncG9wdXBfX2NvbnRlbnQnKTtcclxuXHJcblx0XHRsZXQgY29udGVudCA9IGJ0bi5wYXJlbnROb2RlO1xyXG5cclxuXHRcdGxldCB0ZXh0ID0gY29udGVudFxyXG5cdFx0XHQucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLnRleHQpXHJcblx0XHRcdC50ZXh0Q29udGVudDtcclxuXHRcdGNvbnRlbnRFbGVtZW50LmlubmVySFRNTCA9IHRleHQ7XHJcblxyXG5cdFx0bGV0IHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0dGl0bGVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3BvcHVwX190aXRsZScpO1xyXG5cclxuXHRcdGxldCB0aXRsZSA9IGNvbnRlbnRcclxuXHRcdFx0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy50aXRsZSlcclxuXHRcdFx0LnRleHRDb250ZW50O1xyXG5cdFx0dGl0bGVFbGVtZW50LmlubmVySFRNTCA9IHRpdGxlO1xyXG5cclxuXHRcdGxldCBjbG9zZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuXHRcdGNsb3NlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfX2Nsb3NlXCIpO1xyXG5cdFx0Y2xvc2VFbGVtZW50LmlubmVySFRNTCA9ICc8c3ZnIGNsYXNzPVwicG9wdXBfX2Nsb3NlLXBpY3R1cmVcIj48dXNlIHhsaW5rOmhyZWY9XCIuL2ltZy9pY29ucy9teXNwcml0ZS5zdmcjY2xvc2VcIj48L3VzZT48L3N2Zz4nO1xyXG5cdFx0Y2xvc2VFbGVtZW50LmhyZWYgPSBcIiNcIjtcclxuXHRcdGNsb3NlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0X2Nsb3NlUG9wdXAob3ZlcmxheUVsZW1lbnQpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0b3ZlcmxheUVsZW1lbnQuYXBwZW5kQ2hpbGQocG9wdXBFbGVtZW50KTtcclxuXHRcdHBvcHVwRWxlbWVudC5hcHBlbmRDaGlsZCh0aXRsZUVsZW1lbnQpO1xyXG5cdFx0cG9wdXBFbGVtZW50LmFwcGVuZENoaWxkKGNvbnRlbnRFbGVtZW50KTtcclxuXHRcdHBvcHVwRWxlbWVudC5hcHBlbmRDaGlsZChjbG9zZUVsZW1lbnQpO1xyXG5cclxuXHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQob3ZlcmxheUVsZW1lbnQpO1xyXG5cdH07XHJcblxyXG5cdGxldCBfY2xvc2VQb3B1cCA9IG92ZXJsYXkgPT4ge1xyXG5cdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTtcclxuXHR9O1xyXG5cclxuXHRsZXQgYWRkTGlzdGVuZXJzID0gKCkgPT4ge1xyXG5cdFx0d3JhcHBlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b29nbGVQb3B1cClcclxuXHR9O1xyXG5cclxuXHRyZXR1cm4ge1xyXG5cdFx0aW5pdDogYWRkTGlzdGVuZXJzXHJcblx0fVxyXG59O1xyXG5cclxucG9wdXAoe1xyXG5cdHdyYXBwZXI6IFwicmV2aWV3c19fbGlzdFwiLFxyXG5cdGJ0bjogXCJyZXZpZXdzX19idXR0b25cIixcclxuXHR0aXRsZTogXCJyZXZpZXdzX190aXRsZVwiLFxyXG5cdHRleHQ6IFwicmV2aWV3c19fdGV4dFwiXHJcbn0pLmluaXQoKTtcclxuXHJcbi8qIE9uZSBQYWdlIFNjcm9sbCAqL1xyXG5cclxubGV0IE9uZVBhZ2VTY3JvbGwgPSBvcHRpb25zID0+IHtcclxuXHRsZXQgY3VycmVudFNlY3Rpb24gPSAwO1xyXG5cdGxldCBjb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy5jb250ZW50KTtcclxuXHRsZXQgY291bnRTZWN0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nK29wdGlvbnMuc2VjdGlvbikubGVuZ3RoO1xyXG5cdGxldCBsaXN0TGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbJytvcHRpb25zLmF0dHJpYnV0ZSsnXScpO1xyXG5cdGxldCBzY3JvbGwgPSBmYWxzZTtcclxuXHJcblx0bGV0IF9zbGlkZVRvU2VjdGlvbiA9IChpbmRleFNlY3Rpb24pID0+IHtcclxuXHRcdGlmICghc2Nyb2xsKSB7XHJcblx0XHRcdGlmIChpbmRleFNlY3Rpb24gPj0gMCAmJiBpbmRleFNlY3Rpb24gPCBjb3VudFNlY3Rpb25zKSB7XHJcblx0XHRcdFx0Y3VycmVudFNlY3Rpb24gPSBpbmRleFNlY3Rpb247XHJcblxyXG5cdFx0XHRcdHNjcm9sbCA9IHRydWU7XHJcblxyXG5cdFx0XHRcdGxldCBwb3NpdGlvbiA9IGluZGV4U2VjdGlvbiAqIC0xMDAgKyAnJSc7XHJcblxyXG5cdFx0XHRcdGNvbnRlbnQuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0pYDtcclxuXHRcdFx0XHRjb250ZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259KWA7XHJcblxyXG5cdFx0XHRcdGxldCBzaWRlTmF2RWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIG9wdGlvbnMuc2lkZU5hdmlnYXRpb24pO1xyXG5cdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgc2lkZU5hdkVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0XHRpZiAoaSAhPSBpbmRleFNlY3Rpb24pIHtcclxuXHRcdFx0XHRcdFx0c2lkZU5hdkVsZW1lbnRzW2ldLmNsYXNzTGlzdC5yZW1vdmUob3B0aW9ucy5zaWRlTmF2aWdhdGlvbiArICctLWFjdGl2ZScpO1xyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0c2lkZU5hdkVsZW1lbnRzW2ldLmNsYXNzTGlzdC5hZGQob3B0aW9ucy5zaWRlTmF2aWdhdGlvbiArICctLWFjdGl2ZScpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XHJcblx0XHRcdFx0XHRzY3JvbGwgPSBmYWxzZTtcclxuXHRcdFx0XHR9LCAxMzAwKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdC8vaGFuZGxlcnMgZm9yIGtleWJvYXJkXHJcblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGUgPT4ge1xyXG5cdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcclxuXHRcdFx0Y2FzZSA0MDogLy9kb3duXHJcblx0XHRcdFx0X3NsaWRlVG9TZWN0aW9uKGN1cnJlbnRTZWN0aW9uICsgMSk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgMzg6IC8vdXBcclxuXHRcdFx0XHRfc2xpZGVUb1NlY3Rpb24oY3VycmVudFNlY3Rpb24gLSAxKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0Ly9oYW5kbGVycyBmb3IgbGlua3NcclxuXHRsaXN0TGlua3MuZm9yRWFjaChpdGVtID0+IHtcclxuXHRcdGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRsZXQgaW5kZXggPSBwYXJzZUludCgoZS50YXJnZXQpLmdldEF0dHJpYnV0ZShvcHRpb25zLmF0dHJpYnV0ZSkpO1xyXG5cdFx0XHQvL2ZpeCBmb3IgYnV0dG9uLWRvd25cclxuXHRcdFx0aWYgKCEoaW5kZXggPj0gMCkpIHtcclxuXHRcdFx0XHRpbmRleCA9IHBhcnNlSW50KChlLmN1cnJlbnRUYXJnZXQpLmdldEF0dHJpYnV0ZShvcHRpb25zLmF0dHJpYnV0ZSkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdF9zbGlkZVRvU2VjdGlvbihpbmRleCk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHJcblx0Ly9oYW5kbGVycyBmb3Igd2hlZWxcclxuXHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIGUgPT4ge1xyXG5cdFx0bGV0IGRlbHRhWSA9IGUuZGVsdGFZO1xyXG5cclxuXHRcdGxldCBpbmRleCA9IGRlbHRhWSA+IDAgPyBjdXJyZW50U2VjdGlvbiArIDE6IGN1cnJlbnRTZWN0aW9uIC0gMTtcclxuXHJcblx0XHRfc2xpZGVUb1NlY3Rpb24oaW5kZXgpO1xyXG5cdH0pO1xyXG59O1xyXG5cclxuT25lUGFnZVNjcm9sbCh7XHJcblx0Y29udGVudDogJ2NvbnRlbnQnLFxyXG5cdHNlY3Rpb246ICdzZWN0aW9uJyxcclxuXHRzaWRlTmF2aWdhdGlvbjogJ3NpZGUtbmF2aWdhdGlvbl9faXRlbScsXHJcblx0YXR0cmlidXRlOiAnZGF0YS1zY3JvbGwtdG8nXHJcbn0pOyJdfQ==
