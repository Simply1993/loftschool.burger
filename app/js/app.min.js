/* Hamburger menu */
let hamburger = options => {
	let button = document.querySelector(options.button);
	let menu = document.querySelector(options.menu);
	let list = document.querySelector(".mobile-menu__list");

	let _openMenu = e => {
		e.preventDefault();

		menu.classList.toggle("active");
		document.body.classList.toggle("lock");
	};

	let _closeMenu = e => {
		e.preventDefault();

		if (e.target.className == "mobile-menu__link") {
			menu.classList.remove("active");
			document.body.classList.remove("lock");
		}
	};

	let addListeners = () => {
		button.addEventListener("click", _openMenu);
		list.addEventListener("click", _closeMenu);
	};

	return {
		init: addListeners
	};
};

hamburger({
	button: ".hamburger-menu-btn",
	menu: ".mobile-menu"
}).init();

/* Vertical Accordeon */
// let verticalAccordeon = (function (options) {
// 	let list = document.querySelector(options.listSelector);
// 	let itemsList = list.querySelectorAll('.accordeon__item');
//
// 	let _getHeight = function _getHeight(elem) {
// 		let height = elem.scrollHeight + 'px';
// 		return height;
// 	};
//
// 	let _toogleItems = function (e) {
// 		e.preventDefault();
//
// 		if (e.target.className == options.linkClass) {
// 			let item = e.target.parentNode;
// 			let contentItem = item.querySelector('.accordeon__item-content');
//
// 			if (!item.classList.contains(options.activeItemClass)) {
// 				_closeItems(itemsList);
// 				_openItem(item, contentItem);
// 			} else {
// 				_closeItem(item, contentItem);
// 			}
// 		}
// 	};
//
// 	let _openItem = function _openItem(item, contentItem) {
// 		let contentHeight = _getHeight(contentItem);
//
// 		item.classList.toggle(options.activeItemClass);
// 		contentItem.style.height = contentHeight;
// 	};
//
// 	let _closeItem = function _closeItem(item, contentItem) {
// 		contentItem.style.height = '';
// 		item.classList.remove(options.activeItemClass);
// 	};
//
// 	let _closeItems = function _closeItems(items) {
// 		for (let i = 0; i < items.length; i++) {
// 			let contentItem = items[i].querySelector('.accordeon__item-content');
// 			_closeItem(items[i], contentItem);
// 		}
// 	};
//
// 	let addListeners = function () {
// 		list.addEventListener('click', _toogleItems)
// 	};
//
// 	return {
// 		init: addListeners
// 	}
// })({
// 	listSelector: ".accordeon__list",
// 	linkClass: "accordeon__trigger",
// 	activeItemClass: "accordeon__item--active",
// });
//
// verticalAccordeon.init();

/* Horizontal Accordeon */
// let horizontalAccordeon = (function (options) {
// 	let list = document.querySelector('.'+options.list);
// 	let itemsList = list.querySelectorAll('.'+options.item);
//
// 	/* calculate needed width */
// 	let userWidth = window.innerWidth;
// 	let titleItem = list.querySelector('.'+options.link);
// 	let widthTitle = titleItem.clientWidth;
// 	let neededWidth = userWidth - itemsList.length * widthTitle;
// 	console.log(neededWidth);
// 	neededWidth = (neededWidth > 520) ? 520 : neededWidth;
//
// 	let _toogleItems = function (e) {
// 		e.preventDefault();
//
// 		if (e.target.className == options.link) {
// 			let item = e.target.parentNode;
// 			let contentItem = item.querySelector('.'+options.content);
//
// 			if (!item.classList.contains(options.activeItem)) {
// 				_closeItems(itemsList);
// 				_openItem(item, contentItem);
// 			} else {
// 				_closeItem(item, contentItem);
// 			}
// 		}
// 	};
//
// 	let _openItem = function _openItem(item, contentItem) {
// 		item.classList.toggle(options.activeItem);
// 		contentItem.style.width = neededWidth + 'px';
// 	};
//
// 	let _closeItem = function _closeItem(item, contentItem) {
// 		contentItem.style.width = '';
// 		item.classList.remove(options.activeItem);
// 	};
//
// 	let _closeItems = function _closeItems(items) {
// 		for (let i = 0; i < items.length; i++) {
// 			let contentItem = items[i].querySelector('.'+options.content);
// 			_closeItem(items[i], contentItem);
// 		}
// 	};
//
// 	let addListeners = function () {
// 		list.addEventListener('click', _toogleItems)
// 	};
//
// 	return {
// 		init: addListeners
// 	}
// })({
// 	list: "menu-accordeon__list",
// 	item: "menu-accordeon__item",
// 	activeItem: "menu-accordeon__item--active",
// 	link: "menu-accordeon__trigger",
// 	content: "menu-accordeon__item-content"
// });
//
// horizontalAccordeon.init();

/* Multi-accordeon */
let multiAcco = options => {
	let list = document.querySelector('.' + options.list);
	let itemsList = list.querySelectorAll('.' + options.item);

	if (options.direction == "horizontal") {
		/* for calculate needed width */
		let userWidth = window.innerWidth;
		let titleItem = list.querySelector('.' + options.link);
		let widthTitle = titleItem.clientWidth;
		var neededWidth = userWidth - itemsList.length * widthTitle;
		neededWidth = (neededWidth > 520) ? '520px' : neededWidth + 'px';
	} else if (options.direction == "vertical") {
		/* for calculate needed height */
		var _getHeight = elem => elem.scrollHeight + 'px';
	}

	let _toogleItems = e => {
		e.preventDefault();

		if (e.target.className == options.link) {
			let item = e.target.parentNode;
			let contentItem = item.querySelector('.' + options.content);

			if (!item.classList.contains(options.activeItem)) {
				_closeItems(itemsList);
				_openItem(item, contentItem);
			} else {
				_closeItem(item, contentItem);
			}
		}
	};

	let _openItem = (item, contentItem) => {
		if (options.direction == "horizontal") {
			contentItem.style.width = neededWidth;
		} else if (options.direction == "vertical") {
			let contentHeight = _getHeight(contentItem);
			contentItem.style.height = contentHeight;
		}
		item.classList.toggle(options.activeItem);
	};

	let _closeItem = (item, contentItem) => {
		if (options.direction == "horizontal") {
			contentItem.style.width = '';
		} else if (options.direction == "vertical") {
			contentItem.style.height = '';
		}

		item.classList.remove(options.activeItem);
	};

	let _closeItems = items => {
		for (let i = 0; i < items.length; i++) {
			let contentItem = items[i].querySelector('.' + options.content);
			_closeItem(items[i], contentItem);
		}
	};

	let addListeners = () => {
		list.addEventListener('click', _toogleItems)
	};

	return {
		init: addListeners
	}
};

multiAcco({
	direction: "horizontal",
	list: "menu-accordeon__list",
	item: "menu-accordeon__item",
	activeItem: "menu-accordeon__item--active",
	link: "menu-accordeon__trigger",
	content: "menu-accordeon__item-content"
}).init();

multiAcco({
	direction: "vertical",
	list: "accordeon__list",
	item: "accordeon__item",
	activeItem: "accordeon__item--active",
	link: "accordeon__trigger",
	content: "accordeon__item-content"
}).init();

/* popup */
let popup = options => {
	let wrapper = document.querySelector('.' + options.wrapper);

	let _tooglePopup = e => {
		e.preventDefault();

		if (e.target.className == options.btn) {
			_openPopup(e.target);
		}
	};

	let _openPopup = btn => {
		let overlayElement = document.createElement('div');
		overlayElement.classList.add('overlay');

		let popupElement = document.createElement('div');
		popupElement.classList.add('popup');

		let contentElement = document.createElement('div');
		contentElement.classList.add('popup__content');

		let content = btn.parentNode;

		let text = content
			.querySelector('.' + options.text)
			.textContent;
		contentElement.innerHTML = text;

		let titleElement = document.createElement('div');
		titleElement.classList.add('popup__title');

		let title = content
			.querySelector('.' + options.title)
			.textContent;
		titleElement.innerHTML = title;

		let closeElement = document.createElement("a");
		closeElement.classList.add("popup__close");
		closeElement.innerHTML = '<svg class="popup__close-picture"><use xlink:href="./img/icons/mysprite.svg#close"></use></svg>';
		closeElement.href = "#";
		closeElement.addEventListener("click", e => {
			e.preventDefault();
			_closePopup(overlayElement);
		});

		overlayElement.appendChild(popupElement);
		popupElement.appendChild(titleElement);
		popupElement.appendChild(contentElement);
		popupElement.appendChild(closeElement);

		document.body.appendChild(overlayElement);
	};

	let _closePopup = overlay => {
		document.body.removeChild(overlay);
	};

	let addListeners = () => {
		wrapper.addEventListener('click', _tooglePopup)
	};

	return {
		init: addListeners
	}
};

popup({
	wrapper: "reviews__list",
	btn: "reviews__button",
	title: "reviews__title",
	text: "reviews__text"
}).init();

//check mobile devices
let checkMobile = () => {
	let isMobile = false;
	if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Opera Mobile|Kindle|Windows Phone|PSP|AvantGo|Atomic Web Browser|Blazer|Chrome Mobile|Dolphin|Dolfin|Doris|GO Browser|Jasmine|MicroB|Mobile Firefox|Mobile Safari|Mobile Silk|Motorola Internet Browser|NetFront|NineSky|Nokia Web Browser|Obigo|Openwave Mobile Browser|Palm Pre web browser|Polaris|PS Vita browser|Puffin|QQbrowser|SEMC Browser|Skyfire|Tear|TeaShark|UC Browser|uZard Web|wOSBrowser|Yandex.Browser mobile/i.test(navigator.userAgent)) isMobile = true;
	return isMobile;
};

/* One Page Scroll */
let OnePageScroll = options => {
	let currentSection = 0;
	let content = document.querySelector('.' + options.content);
	let countSections = document.querySelectorAll('.' + options.section).length;
	let listLinks = document.querySelectorAll('[' + options.attribute + ']');
	let scroll = false;

	let _swipeDetected = element => {
		let startX,
			startY,
			distX,
			distY,
			deviation = 200, //deviation from main direction
			threshold = 150, //min range for swipe
			allowedTime = 1000, //max time for range
			elapsedTime, //runtime
			startTime;

		element.addEventListener('touchstart', e => {
			let touchobj = e.changedTouches[0];
			startX = touchobj.pageX;
			startY = touchobj.pageY;
			startTime = new Date().getTime(); //time touch with sensor
		});

		//disable touchmove
		element.addEventListener('touchmove', e => e.preventDefault());

		element.addEventListener('touchend', e => {
			let touchobj = e.changedTouches[0];
			distX = touchobj.pageX - startX; //get horizontal move
			distY = touchobj.pageY - startY; //get vertical move
			elapsedTime = new Date().getTime() - startTime;
			if (elapsedTime <= allowedTime) {
				if (Math.abs(distY) >= threshold && Math.abs(distX) <= deviation) { //vertical swipe
					swipedir = (distY < 0) ? _slideToSection(currentSection + 1) : _slideToSection(currentSection - 1)
				}
			}
		});
	};

	let _slideToSection = (indexSection) => {
		if (!scroll) {
			if (indexSection >= 0 && indexSection < countSections) {
				currentSection = indexSection;

				scroll = true;

				let position = indexSection * -100 + '%';

				content.style.transform = `translateY(${position})`;
				content.style.webkitTransform = `translateY(${position})`;

				let sideNavElements = document.querySelectorAll('.' + options.sideNavigation);
				for (let i = 0; i < sideNavElements.length; i++) {
					if (i != indexSection) {
						sideNavElements[i].classList.remove(options.sideNavigation + '--active');
					} else {
						sideNavElements[i].classList.add(options.sideNavigation + '--active');
					}
				}

				setTimeout(() => {
					scroll = false;
				}, 1300);
			}
		}
	};

	//handlers for keyboard
	document.addEventListener('keydown', e => {
		switch (e.keyCode) {
			case 40: //down
				_slideToSection(currentSection + 1);
				break;
			case 38: //up
				_slideToSection(currentSection - 1);
				break;
		}
	});

	//handlers for links
	listLinks.forEach(item => {
		item.addEventListener('click', e => {
			e.preventDefault();
			let index = parseInt((e.target).getAttribute(options.attribute));
			//fix for button-down
			if (!(index >= 0)) {
				index = parseInt((e.currentTarget).getAttribute(options.attribute));
			}
			_slideToSection(index);
		});
	});

	//handlers for wheel
	document.addEventListener('wheel', e => {
		let deltaY = e.deltaY;

		let index = deltaY > 0 ? currentSection + 1 : currentSection - 1;

		_slideToSection(index);
	});

	//handlers for swipe
	if (checkMobile) {
		_swipeDetected(content);
	}
};

OnePageScroll({
	content: 'content',
	section: 'section',
	sideNavigation: 'side-navigation__item',
	attribute: 'data-scroll-to'
});

/* slider */
let slider = options => {
	let wrapper = document.querySelector('.'+options.wrapper);
	let widthWrapper = wrapper.clientWidth;
	wrapper.style.width = widthWrapper  + 'px';

	let list = document.querySelector('.'+options.list);
	let items = document.querySelectorAll('.'+options.item);

	let left = document.querySelector('.'+options.prev);
	let right = document.querySelector('.'+options.next);

	items.forEach(element => {
		element.style.width = widthWrapper  + 'px';
	});

	let minRight = 0;
	let maxRight = widthWrapper * (items.length - 1);
	let step = widthWrapper;
	let currentRight = 0;

	let _slideRight = value => {
		if (value <= maxRight) {
			currentRight += step;
			list.style.right = currentRight + "px";
		}
	};

	let _slideLeft = value => {
		if (value >= minRight) {
			currentRight -= step;
			list.style.right = currentRight + "px";
		}
	};

	let initial = () => {
		list.style.right = currentRight;

		right.addEventListener("click", e => {
			e.preventDefault();

			_slideRight(currentRight + step);
		});

		left.addEventListener("click", e => {
			e.preventDefault();

			_slideLeft(currentRight - step);
		});

		_swipeDetected(wrapper);
	};

	let _swipeDetected = element => {
		let startX,
			startY,
			distX,
			distY,
			deviation = 200, //deviation from main direction
			threshold = 150, //min range for swipe
			allowedTime = 1000, //max time for range
			elapsedTime, //runtime
			startTime;

		element.addEventListener('touchstart', e => {
			let touchobj = e.changedTouches[0];
			startX = touchobj.pageX;
			startY = touchobj.pageY;
			startTime = new Date().getTime(); //time touch with sensor
		});

		//disable touchmove
		element.addEventListener('touchmove', e => e.preventDefault());

		element.addEventListener('touchend', e => {
			let touchobj = e.changedTouches[0];
			distX = touchobj.pageX - startX; //get horizontal move
			distY = touchobj.pageY - startY; //get vertical move
			elapsedTime = new Date().getTime() - startTime;
			if (elapsedTime <= allowedTime) {
				if (Math.abs(distX) >= threshold && Math.abs(distY) <= deviation) { //horizontal swipe
					swipedir = (distX < 0) ? _slideRight(currentRight + step) : _slideLeft(currentRight - step)
				}
			}
		});
	};

	let _mobileIngredients = () => {
		let btnIngredients = document.querySelector('.burger__ingredients');
		let btnCloseIngredients = document.querySelector('.dropdown__close');

		btnCloseIngredients.addEventListener('click', e => {
			e.preventDefault();

			btnIngredients.classList.remove('active');
		});
		btnCloseIngredients.addEventListener('touchstart', e => {
			e.preventDefault();

			btnIngredients.classList.remove('active');
		});

		if (checkMobile) {
			btnIngredients.addEventListener('click', e => {
				btnIngredients.classList.add("active");
			});
		}
		btnIngredients.addEventListener('mouseenter', e => {
			btnIngredients.classList.add("active");
		});

		btnIngredients.addEventListener('mouseleave', e => {
			btnIngredients.classList.remove("active");
		});
	};
	_mobileIngredients();

	return {
		init: initial
	}
};

slider({
	wrapper: 'burger__wrapper',
	list: 'burger__list',
	item: 'burger__item',
	next: 'burger__controls-link--next',
	prev: 'burger__controls-link--prev'
}).init();

/* form order */
const formOrder = $("#form-order");
const formReset = $(".form__reset");
formOrder.on('submit', function(e){
		e.preventDefault();

		let result = $.ajax(formOrder.attr('action'), {
			type: formOrder.attr('method'),
			data: $(this).serialize(),
			dataType: 'JSON'
		});

		result.done(function (data) {
			formReset.trigger('click');
		});

		result.fail(function (data) {
			console.log(data);
		});

		result.always(function (data) {
			let answer = openOverlay({
				classContainer: 'form__answer',
				classTitle: 'form__answer-title',
				classClose: 'form__answer_close',
				content: data.msg
			});

			document.body.appendChild(answer);
		})
	});

var openOverlay = options => {
	const overlayElement = document.createElement("div");
	overlayElement.classList.add("overlay");

	const containerElement = document.createElement("div");
	containerElement.classList.add(options.classContainer);

	const contentElement = document.createElement("div");
	contentElement.classList.add(options.classTitle);
	contentElement.textContent = options.content;

	const closeElement = document.createElement("button");
	closeElement.classList.add(options.classClose);
	closeElement.classList.add('order-link');
	closeElement.textContent = "Закрыть";
	closeElement.addEventListener("click", function() {
		document.body.removeChild(overlayElement);
	});

	overlayElement.appendChild(containerElement);
	containerElement.appendChild(contentElement);
	containerElement.appendChild(closeElement);

	return overlayElement;
};

/* yandex map */
ymaps.ready(init);

var placemarks = [
		{
			latitude: 59.97,
			longitude: 30.31,
			hintContent: "ул. Литераторов, д. 19",
			balloonContent: "ул. Литераторов, д. 19"
		},
		{
			latitude: 59.94,
			longitude: 30.25,
			hintContent: "Малый проспект ВО, д 64",
			balloonContent: "Малый проспект ВО, д 64"
		},
		{
			latitude: 59.93,
			longitude: 30.34,
			hintContent: "наб. реки Фонтанки, д. 56",
			balloonContent: "наб. реки Фонтанки, д. 56"
		}
	];

function init() {
	var mapYandex = new ymaps.Map("map-yandex", {
		center: [59.94, 30.32],
		zoom: 12
	});

	placemarks.forEach(function (obj) {
		let placemark = new ymaps.Placemark(
			[obj.latitude, obj.longitude],
			{
				hintContent: obj.hintContent,
				hintContent: obj.balloonContent
			},
			{
				iconLayout: "default#image",
				iconImageHref: "./img/icons/map-marker.svg",
				iconImageSize: [46, 57],
				iconImageOffset: [-15, -50]
			}
		);

		mapYandex.geoObjects.add(placemark);
	});

	mapYandex.behaviors.disable("scrollZoom");
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBIYW1idXJnZXIgbWVudSAqL1xyXG5sZXQgaGFtYnVyZ2VyID0gb3B0aW9ucyA9PiB7XHJcblx0bGV0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5idXR0b24pO1xyXG5cdGxldCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLm1lbnUpO1xyXG5cdGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2JpbGUtbWVudV9fbGlzdFwiKTtcclxuXHJcblx0bGV0IF9vcGVuTWVudSA9IGUgPT4ge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdG1lbnUuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiKTtcclxuXHRcdGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnRvZ2dsZShcImxvY2tcIik7XHJcblx0fTtcclxuXHJcblx0bGV0IF9jbG9zZU1lbnUgPSBlID0+IHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRpZiAoZS50YXJnZXQuY2xhc3NOYW1lID09IFwibW9iaWxlLW1lbnVfX2xpbmtcIikge1xyXG5cdFx0XHRtZW51LmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XHJcblx0XHRcdGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShcImxvY2tcIik7XHJcblx0XHR9XHJcblx0fTtcclxuXHJcblx0bGV0IGFkZExpc3RlbmVycyA9ICgpID0+IHtcclxuXHRcdGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgX29wZW5NZW51KTtcclxuXHRcdGxpc3QuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIF9jbG9zZU1lbnUpO1xyXG5cdH07XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBhZGRMaXN0ZW5lcnNcclxuXHR9O1xyXG59O1xyXG5cclxuaGFtYnVyZ2VyKHtcclxuXHRidXR0b246IFwiLmhhbWJ1cmdlci1tZW51LWJ0blwiLFxyXG5cdG1lbnU6IFwiLm1vYmlsZS1tZW51XCJcclxufSkuaW5pdCgpO1xyXG5cclxuLyogVmVydGljYWwgQWNjb3JkZW9uICovXHJcbi8vIGxldCB2ZXJ0aWNhbEFjY29yZGVvbiA9IChmdW5jdGlvbiAob3B0aW9ucykge1xyXG4vLyBcdGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvcHRpb25zLmxpc3RTZWxlY3Rvcik7XHJcbi8vIFx0bGV0IGl0ZW1zTGlzdCA9IGxpc3QucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbl9faXRlbScpO1xyXG4vL1xyXG4vLyBcdGxldCBfZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gX2dldEhlaWdodChlbGVtKSB7XHJcbi8vIFx0XHRsZXQgaGVpZ2h0ID0gZWxlbS5zY3JvbGxIZWlnaHQgKyAncHgnO1xyXG4vLyBcdFx0cmV0dXJuIGhlaWdodDtcclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBfdG9vZ2xlSXRlbXMgPSBmdW5jdGlvbiAoZSkge1xyXG4vLyBcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vL1xyXG4vLyBcdFx0aWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBvcHRpb25zLmxpbmtDbGFzcykge1xyXG4vLyBcdFx0XHRsZXQgaXRlbSA9IGUudGFyZ2V0LnBhcmVudE5vZGU7XHJcbi8vIFx0XHRcdGxldCBjb250ZW50SXRlbSA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbl9faXRlbS1jb250ZW50Jyk7XHJcbi8vXHJcbi8vIFx0XHRcdGlmICghaXRlbS5jbGFzc0xpc3QuY29udGFpbnMob3B0aW9ucy5hY3RpdmVJdGVtQ2xhc3MpKSB7XHJcbi8vIFx0XHRcdFx0X2Nsb3NlSXRlbXMoaXRlbXNMaXN0KTtcclxuLy8gXHRcdFx0XHRfb3Blbkl0ZW0oaXRlbSwgY29udGVudEl0ZW0pO1xyXG4vLyBcdFx0XHR9IGVsc2Uge1xyXG4vLyBcdFx0XHRcdF9jbG9zZUl0ZW0oaXRlbSwgY29udGVudEl0ZW0pO1xyXG4vLyBcdFx0XHR9XHJcbi8vIFx0XHR9XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgX29wZW5JdGVtID0gZnVuY3Rpb24gX29wZW5JdGVtKGl0ZW0sIGNvbnRlbnRJdGVtKSB7XHJcbi8vIFx0XHRsZXQgY29udGVudEhlaWdodCA9IF9nZXRIZWlnaHQoY29udGVudEl0ZW0pO1xyXG4vL1xyXG4vLyBcdFx0aXRlbS5jbGFzc0xpc3QudG9nZ2xlKG9wdGlvbnMuYWN0aXZlSXRlbUNsYXNzKTtcclxuLy8gXHRcdGNvbnRlbnRJdGVtLnN0eWxlLmhlaWdodCA9IGNvbnRlbnRIZWlnaHQ7XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgX2Nsb3NlSXRlbSA9IGZ1bmN0aW9uIF9jbG9zZUl0ZW0oaXRlbSwgY29udGVudEl0ZW0pIHtcclxuLy8gXHRcdGNvbnRlbnRJdGVtLnN0eWxlLmhlaWdodCA9ICcnO1xyXG4vLyBcdFx0aXRlbS5jbGFzc0xpc3QucmVtb3ZlKG9wdGlvbnMuYWN0aXZlSXRlbUNsYXNzKTtcclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBfY2xvc2VJdGVtcyA9IGZ1bmN0aW9uIF9jbG9zZUl0ZW1zKGl0ZW1zKSB7XHJcbi8vIFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbi8vIFx0XHRcdGxldCBjb250ZW50SXRlbSA9IGl0ZW1zW2ldLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX2l0ZW0tY29udGVudCcpO1xyXG4vLyBcdFx0XHRfY2xvc2VJdGVtKGl0ZW1zW2ldLCBjb250ZW50SXRlbSk7XHJcbi8vIFx0XHR9XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgYWRkTGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xyXG4vLyBcdFx0bGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90b29nbGVJdGVtcylcclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdHJldHVybiB7XHJcbi8vIFx0XHRpbml0OiBhZGRMaXN0ZW5lcnNcclxuLy8gXHR9XHJcbi8vIH0pKHtcclxuLy8gXHRsaXN0U2VsZWN0b3I6IFwiLmFjY29yZGVvbl9fbGlzdFwiLFxyXG4vLyBcdGxpbmtDbGFzczogXCJhY2NvcmRlb25fX3RyaWdnZXJcIixcclxuLy8gXHRhY3RpdmVJdGVtQ2xhc3M6IFwiYWNjb3JkZW9uX19pdGVtLS1hY3RpdmVcIixcclxuLy8gfSk7XHJcbi8vXHJcbi8vIHZlcnRpY2FsQWNjb3JkZW9uLmluaXQoKTtcclxuXHJcbi8qIEhvcml6b250YWwgQWNjb3JkZW9uICovXHJcbi8vIGxldCBob3Jpem9udGFsQWNjb3JkZW9uID0gKGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbi8vIFx0bGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJytvcHRpb25zLmxpc3QpO1xyXG4vLyBcdGxldCBpdGVtc0xpc3QgPSBsaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nK29wdGlvbnMuaXRlbSk7XHJcbi8vXHJcbi8vIFx0LyogY2FsY3VsYXRlIG5lZWRlZCB3aWR0aCAqL1xyXG4vLyBcdGxldCB1c2VyV2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuLy8gXHRsZXQgdGl0bGVJdGVtID0gbGlzdC5xdWVyeVNlbGVjdG9yKCcuJytvcHRpb25zLmxpbmspO1xyXG4vLyBcdGxldCB3aWR0aFRpdGxlID0gdGl0bGVJdGVtLmNsaWVudFdpZHRoO1xyXG4vLyBcdGxldCBuZWVkZWRXaWR0aCA9IHVzZXJXaWR0aCAtIGl0ZW1zTGlzdC5sZW5ndGggKiB3aWR0aFRpdGxlO1xyXG4vLyBcdGNvbnNvbGUubG9nKG5lZWRlZFdpZHRoKTtcclxuLy8gXHRuZWVkZWRXaWR0aCA9IChuZWVkZWRXaWR0aCA+IDUyMCkgPyA1MjAgOiBuZWVkZWRXaWR0aDtcclxuLy9cclxuLy8gXHRsZXQgX3Rvb2dsZUl0ZW1zID0gZnVuY3Rpb24gKGUpIHtcclxuLy8gXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuLy9cclxuLy8gXHRcdGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gb3B0aW9ucy5saW5rKSB7XHJcbi8vIFx0XHRcdGxldCBpdGVtID0gZS50YXJnZXQucGFyZW50Tm9kZTtcclxuLy8gXHRcdFx0bGV0IGNvbnRlbnRJdGVtID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuJytvcHRpb25zLmNvbnRlbnQpO1xyXG4vL1xyXG4vLyBcdFx0XHRpZiAoIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKG9wdGlvbnMuYWN0aXZlSXRlbSkpIHtcclxuLy8gXHRcdFx0XHRfY2xvc2VJdGVtcyhpdGVtc0xpc3QpO1xyXG4vLyBcdFx0XHRcdF9vcGVuSXRlbShpdGVtLCBjb250ZW50SXRlbSk7XHJcbi8vIFx0XHRcdH0gZWxzZSB7XHJcbi8vIFx0XHRcdFx0X2Nsb3NlSXRlbShpdGVtLCBjb250ZW50SXRlbSk7XHJcbi8vIFx0XHRcdH1cclxuLy8gXHRcdH1cclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBfb3Blbkl0ZW0gPSBmdW5jdGlvbiBfb3Blbkl0ZW0oaXRlbSwgY29udGVudEl0ZW0pIHtcclxuLy8gXHRcdGl0ZW0uY2xhc3NMaXN0LnRvZ2dsZShvcHRpb25zLmFjdGl2ZUl0ZW0pO1xyXG4vLyBcdFx0Y29udGVudEl0ZW0uc3R5bGUud2lkdGggPSBuZWVkZWRXaWR0aCArICdweCc7XHJcbi8vIFx0fTtcclxuLy9cclxuLy8gXHRsZXQgX2Nsb3NlSXRlbSA9IGZ1bmN0aW9uIF9jbG9zZUl0ZW0oaXRlbSwgY29udGVudEl0ZW0pIHtcclxuLy8gXHRcdGNvbnRlbnRJdGVtLnN0eWxlLndpZHRoID0gJyc7XHJcbi8vIFx0XHRpdGVtLmNsYXNzTGlzdC5yZW1vdmUob3B0aW9ucy5hY3RpdmVJdGVtKTtcclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBfY2xvc2VJdGVtcyA9IGZ1bmN0aW9uIF9jbG9zZUl0ZW1zKGl0ZW1zKSB7XHJcbi8vIFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbi8vIFx0XHRcdGxldCBjb250ZW50SXRlbSA9IGl0ZW1zW2ldLnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMuY29udGVudCk7XHJcbi8vIFx0XHRcdF9jbG9zZUl0ZW0oaXRlbXNbaV0sIGNvbnRlbnRJdGVtKTtcclxuLy8gXHRcdH1cclxuLy8gXHR9O1xyXG4vL1xyXG4vLyBcdGxldCBhZGRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XHJcbi8vIFx0XHRsaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3Rvb2dsZUl0ZW1zKVxyXG4vLyBcdH07XHJcbi8vXHJcbi8vIFx0cmV0dXJuIHtcclxuLy8gXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG4vLyBcdH1cclxuLy8gfSkoe1xyXG4vLyBcdGxpc3Q6IFwibWVudS1hY2NvcmRlb25fX2xpc3RcIixcclxuLy8gXHRpdGVtOiBcIm1lbnUtYWNjb3JkZW9uX19pdGVtXCIsXHJcbi8vIFx0YWN0aXZlSXRlbTogXCJtZW51LWFjY29yZGVvbl9faXRlbS0tYWN0aXZlXCIsXHJcbi8vIFx0bGluazogXCJtZW51LWFjY29yZGVvbl9fdHJpZ2dlclwiLFxyXG4vLyBcdGNvbnRlbnQ6IFwibWVudS1hY2NvcmRlb25fX2l0ZW0tY29udGVudFwiXHJcbi8vIH0pO1xyXG4vL1xyXG4vLyBob3Jpem9udGFsQWNjb3JkZW9uLmluaXQoKTtcclxuXHJcbi8qIE11bHRpLWFjY29yZGVvbiAqL1xyXG5sZXQgbXVsdGlBY2NvID0gb3B0aW9ucyA9PiB7XHJcblx0bGV0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMubGlzdCk7XHJcblx0bGV0IGl0ZW1zTGlzdCA9IGxpc3QucXVlcnlTZWxlY3RvckFsbCgnLicgKyBvcHRpb25zLml0ZW0pO1xyXG5cclxuXHRpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT0gXCJob3Jpem9udGFsXCIpIHtcclxuXHRcdC8qIGZvciBjYWxjdWxhdGUgbmVlZGVkIHdpZHRoICovXHJcblx0XHRsZXQgdXNlcldpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcblx0XHRsZXQgdGl0bGVJdGVtID0gbGlzdC5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMubGluayk7XHJcblx0XHRsZXQgd2lkdGhUaXRsZSA9IHRpdGxlSXRlbS5jbGllbnRXaWR0aDtcclxuXHRcdHZhciBuZWVkZWRXaWR0aCA9IHVzZXJXaWR0aCAtIGl0ZW1zTGlzdC5sZW5ndGggKiB3aWR0aFRpdGxlO1xyXG5cdFx0bmVlZGVkV2lkdGggPSAobmVlZGVkV2lkdGggPiA1MjApID8gJzUyMHB4JyA6IG5lZWRlZFdpZHRoICsgJ3B4JztcclxuXHR9IGVsc2UgaWYgKG9wdGlvbnMuZGlyZWN0aW9uID09IFwidmVydGljYWxcIikge1xyXG5cdFx0LyogZm9yIGNhbGN1bGF0ZSBuZWVkZWQgaGVpZ2h0ICovXHJcblx0XHR2YXIgX2dldEhlaWdodCA9IGVsZW0gPT4gZWxlbS5zY3JvbGxIZWlnaHQgKyAncHgnO1xyXG5cdH1cclxuXHJcblx0bGV0IF90b29nbGVJdGVtcyA9IGUgPT4ge1xyXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdGlmIChlLnRhcmdldC5jbGFzc05hbWUgPT0gb3B0aW9ucy5saW5rKSB7XHJcblx0XHRcdGxldCBpdGVtID0gZS50YXJnZXQucGFyZW50Tm9kZTtcclxuXHRcdFx0bGV0IGNvbnRlbnRJdGVtID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMuY29udGVudCk7XHJcblxyXG5cdFx0XHRpZiAoIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKG9wdGlvbnMuYWN0aXZlSXRlbSkpIHtcclxuXHRcdFx0XHRfY2xvc2VJdGVtcyhpdGVtc0xpc3QpO1xyXG5cdFx0XHRcdF9vcGVuSXRlbShpdGVtLCBjb250ZW50SXRlbSk7XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0X2Nsb3NlSXRlbShpdGVtLCBjb250ZW50SXRlbSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgX29wZW5JdGVtID0gKGl0ZW0sIGNvbnRlbnRJdGVtKSA9PiB7XHJcblx0XHRpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT0gXCJob3Jpem9udGFsXCIpIHtcclxuXHRcdFx0Y29udGVudEl0ZW0uc3R5bGUud2lkdGggPSBuZWVkZWRXaWR0aDtcclxuXHRcdH0gZWxzZSBpZiAob3B0aW9ucy5kaXJlY3Rpb24gPT0gXCJ2ZXJ0aWNhbFwiKSB7XHJcblx0XHRcdGxldCBjb250ZW50SGVpZ2h0ID0gX2dldEhlaWdodChjb250ZW50SXRlbSk7XHJcblx0XHRcdGNvbnRlbnRJdGVtLnN0eWxlLmhlaWdodCA9IGNvbnRlbnRIZWlnaHQ7XHJcblx0XHR9XHJcblx0XHRpdGVtLmNsYXNzTGlzdC50b2dnbGUob3B0aW9ucy5hY3RpdmVJdGVtKTtcclxuXHR9O1xyXG5cclxuXHRsZXQgX2Nsb3NlSXRlbSA9IChpdGVtLCBjb250ZW50SXRlbSkgPT4ge1xyXG5cdFx0aWYgKG9wdGlvbnMuZGlyZWN0aW9uID09IFwiaG9yaXpvbnRhbFwiKSB7XHJcblx0XHRcdGNvbnRlbnRJdGVtLnN0eWxlLndpZHRoID0gJyc7XHJcblx0XHR9IGVsc2UgaWYgKG9wdGlvbnMuZGlyZWN0aW9uID09IFwidmVydGljYWxcIikge1xyXG5cdFx0XHRjb250ZW50SXRlbS5zdHlsZS5oZWlnaHQgPSAnJztcclxuXHRcdH1cclxuXHJcblx0XHRpdGVtLmNsYXNzTGlzdC5yZW1vdmUob3B0aW9ucy5hY3RpdmVJdGVtKTtcclxuXHR9O1xyXG5cclxuXHRsZXQgX2Nsb3NlSXRlbXMgPSBpdGVtcyA9PiB7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGxldCBjb250ZW50SXRlbSA9IGl0ZW1zW2ldLnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy5jb250ZW50KTtcclxuXHRcdFx0X2Nsb3NlSXRlbShpdGVtc1tpXSwgY29udGVudEl0ZW0pO1xyXG5cdFx0fVxyXG5cdH07XHJcblxyXG5cdGxldCBhZGRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcblx0XHRsaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3Rvb2dsZUl0ZW1zKVxyXG5cdH07XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBhZGRMaXN0ZW5lcnNcclxuXHR9XHJcbn07XHJcblxyXG5tdWx0aUFjY28oe1xyXG5cdGRpcmVjdGlvbjogXCJob3Jpem9udGFsXCIsXHJcblx0bGlzdDogXCJtZW51LWFjY29yZGVvbl9fbGlzdFwiLFxyXG5cdGl0ZW06IFwibWVudS1hY2NvcmRlb25fX2l0ZW1cIixcclxuXHRhY3RpdmVJdGVtOiBcIm1lbnUtYWNjb3JkZW9uX19pdGVtLS1hY3RpdmVcIixcclxuXHRsaW5rOiBcIm1lbnUtYWNjb3JkZW9uX190cmlnZ2VyXCIsXHJcblx0Y29udGVudDogXCJtZW51LWFjY29yZGVvbl9faXRlbS1jb250ZW50XCJcclxufSkuaW5pdCgpO1xyXG5cclxubXVsdGlBY2NvKHtcclxuXHRkaXJlY3Rpb246IFwidmVydGljYWxcIixcclxuXHRsaXN0OiBcImFjY29yZGVvbl9fbGlzdFwiLFxyXG5cdGl0ZW06IFwiYWNjb3JkZW9uX19pdGVtXCIsXHJcblx0YWN0aXZlSXRlbTogXCJhY2NvcmRlb25fX2l0ZW0tLWFjdGl2ZVwiLFxyXG5cdGxpbms6IFwiYWNjb3JkZW9uX190cmlnZ2VyXCIsXHJcblx0Y29udGVudDogXCJhY2NvcmRlb25fX2l0ZW0tY29udGVudFwiXHJcbn0pLmluaXQoKTtcclxuXHJcbi8qIHBvcHVwICovXHJcbmxldCBwb3B1cCA9IG9wdGlvbnMgPT4ge1xyXG5cdGxldCB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLndyYXBwZXIpO1xyXG5cclxuXHRsZXQgX3Rvb2dsZVBvcHVwID0gZSA9PiB7XHJcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0aWYgKGUudGFyZ2V0LmNsYXNzTmFtZSA9PSBvcHRpb25zLmJ0bikge1xyXG5cdFx0XHRfb3BlblBvcHVwKGUudGFyZ2V0KTtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgX29wZW5Qb3B1cCA9IGJ0biA9PiB7XHJcblx0XHRsZXQgb3ZlcmxheUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdG92ZXJsYXlFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ292ZXJsYXknKTtcclxuXHJcblx0XHRsZXQgcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRwb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncG9wdXAnKTtcclxuXHJcblx0XHRsZXQgY29udGVudEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdGNvbnRlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3BvcHVwX19jb250ZW50Jyk7XHJcblxyXG5cdFx0bGV0IGNvbnRlbnQgPSBidG4ucGFyZW50Tm9kZTtcclxuXHJcblx0XHRsZXQgdGV4dCA9IGNvbnRlbnRcclxuXHRcdFx0LnF1ZXJ5U2VsZWN0b3IoJy4nICsgb3B0aW9ucy50ZXh0KVxyXG5cdFx0XHQudGV4dENvbnRlbnQ7XHJcblx0XHRjb250ZW50RWxlbWVudC5pbm5lckhUTUwgPSB0ZXh0O1xyXG5cclxuXHRcdGxldCB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHRpdGxlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9fdGl0bGUnKTtcclxuXHJcblx0XHRsZXQgdGl0bGUgPSBjb250ZW50XHJcblx0XHRcdC5xdWVyeVNlbGVjdG9yKCcuJyArIG9wdGlvbnMudGl0bGUpXHJcblx0XHRcdC50ZXh0Q29udGVudDtcclxuXHRcdHRpdGxlRWxlbWVudC5pbm5lckhUTUwgPSB0aXRsZTtcclxuXHJcblx0XHRsZXQgY2xvc2VFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcblx0XHRjbG9zZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInBvcHVwX19jbG9zZVwiKTtcclxuXHRcdGNsb3NlRWxlbWVudC5pbm5lckhUTUwgPSAnPHN2ZyBjbGFzcz1cInBvcHVwX19jbG9zZS1waWN0dXJlXCI+PHVzZSB4bGluazpocmVmPVwiLi9pbWcvaWNvbnMvbXlzcHJpdGUuc3ZnI2Nsb3NlXCI+PC91c2U+PC9zdmc+JztcclxuXHRcdGNsb3NlRWxlbWVudC5ocmVmID0gXCIjXCI7XHJcblx0XHRjbG9zZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdF9jbG9zZVBvcHVwKG92ZXJsYXlFbGVtZW50KTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdG92ZXJsYXlFbGVtZW50LmFwcGVuZENoaWxkKHBvcHVwRWxlbWVudCk7XHJcblx0XHRwb3B1cEVsZW1lbnQuYXBwZW5kQ2hpbGQodGl0bGVFbGVtZW50KTtcclxuXHRcdHBvcHVwRWxlbWVudC5hcHBlbmRDaGlsZChjb250ZW50RWxlbWVudCk7XHJcblx0XHRwb3B1cEVsZW1lbnQuYXBwZW5kQ2hpbGQoY2xvc2VFbGVtZW50KTtcclxuXHJcblx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXlFbGVtZW50KTtcclxuXHR9O1xyXG5cclxuXHRsZXQgX2Nsb3NlUG9wdXAgPSBvdmVybGF5ID0+IHtcclxuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7XHJcblx0fTtcclxuXHJcblx0bGV0IGFkZExpc3RlbmVycyA9ICgpID0+IHtcclxuXHRcdHdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBfdG9vZ2xlUG9wdXApXHJcblx0fTtcclxuXHJcblx0cmV0dXJuIHtcclxuXHRcdGluaXQ6IGFkZExpc3RlbmVyc1xyXG5cdH1cclxufTtcclxuXHJcbnBvcHVwKHtcclxuXHR3cmFwcGVyOiBcInJldmlld3NfX2xpc3RcIixcclxuXHRidG46IFwicmV2aWV3c19fYnV0dG9uXCIsXHJcblx0dGl0bGU6IFwicmV2aWV3c19fdGl0bGVcIixcclxuXHR0ZXh0OiBcInJldmlld3NfX3RleHRcIlxyXG59KS5pbml0KCk7XHJcblxyXG4vL2NoZWNrIG1vYmlsZSBkZXZpY2VzXHJcbmxldCBjaGVja01vYmlsZSA9ICgpID0+IHtcclxuXHRsZXQgaXNNb2JpbGUgPSBmYWxzZTtcclxuXHRpZiAoL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbml8T3BlcmEgTW9iaWxlfEtpbmRsZXxXaW5kb3dzIFBob25lfFBTUHxBdmFudEdvfEF0b21pYyBXZWIgQnJvd3NlcnxCbGF6ZXJ8Q2hyb21lIE1vYmlsZXxEb2xwaGlufERvbGZpbnxEb3Jpc3xHTyBCcm93c2VyfEphc21pbmV8TWljcm9CfE1vYmlsZSBGaXJlZm94fE1vYmlsZSBTYWZhcml8TW9iaWxlIFNpbGt8TW90b3JvbGEgSW50ZXJuZXQgQnJvd3NlcnxOZXRGcm9udHxOaW5lU2t5fE5va2lhIFdlYiBCcm93c2VyfE9iaWdvfE9wZW53YXZlIE1vYmlsZSBCcm93c2VyfFBhbG0gUHJlIHdlYiBicm93c2VyfFBvbGFyaXN8UFMgVml0YSBicm93c2VyfFB1ZmZpbnxRUWJyb3dzZXJ8U0VNQyBCcm93c2VyfFNreWZpcmV8VGVhcnxUZWFTaGFya3xVQyBCcm93c2VyfHVaYXJkIFdlYnx3T1NCcm93c2VyfFlhbmRleC5Ccm93c2VyIG1vYmlsZS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIGlzTW9iaWxlID0gdHJ1ZTtcclxuXHRyZXR1cm4gaXNNb2JpbGU7XHJcbn07XHJcblxyXG4vKiBPbmUgUGFnZSBTY3JvbGwgKi9cclxubGV0IE9uZVBhZ2VTY3JvbGwgPSBvcHRpb25zID0+IHtcclxuXHRsZXQgY3VycmVudFNlY3Rpb24gPSAwO1xyXG5cdGxldCBjb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicgKyBvcHRpb25zLmNvbnRlbnQpO1xyXG5cdGxldCBjb3VudFNlY3Rpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBvcHRpb25zLnNlY3Rpb24pLmxlbmd0aDtcclxuXHRsZXQgbGlzdExpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnWycgKyBvcHRpb25zLmF0dHJpYnV0ZSArICddJyk7XHJcblx0bGV0IHNjcm9sbCA9IGZhbHNlO1xyXG5cclxuXHRsZXQgX3N3aXBlRGV0ZWN0ZWQgPSBlbGVtZW50ID0+IHtcclxuXHRcdGxldCBzdGFydFgsXHJcblx0XHRcdHN0YXJ0WSxcclxuXHRcdFx0ZGlzdFgsXHJcblx0XHRcdGRpc3RZLFxyXG5cdFx0XHRkZXZpYXRpb24gPSAyMDAsIC8vZGV2aWF0aW9uIGZyb20gbWFpbiBkaXJlY3Rpb25cclxuXHRcdFx0dGhyZXNob2xkID0gMTUwLCAvL21pbiByYW5nZSBmb3Igc3dpcGVcclxuXHRcdFx0YWxsb3dlZFRpbWUgPSAxMDAwLCAvL21heCB0aW1lIGZvciByYW5nZVxyXG5cdFx0XHRlbGFwc2VkVGltZSwgLy9ydW50aW1lXHJcblx0XHRcdHN0YXJ0VGltZTtcclxuXHJcblx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBlID0+IHtcclxuXHRcdFx0bGV0IHRvdWNob2JqID0gZS5jaGFuZ2VkVG91Y2hlc1swXTtcclxuXHRcdFx0c3RhcnRYID0gdG91Y2hvYmoucGFnZVg7XHJcblx0XHRcdHN0YXJ0WSA9IHRvdWNob2JqLnBhZ2VZO1xyXG5cdFx0XHRzdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgLy90aW1lIHRvdWNoIHdpdGggc2Vuc29yXHJcblx0XHR9KTtcclxuXHJcblx0XHQvL2Rpc2FibGUgdG91Y2htb3ZlXHJcblx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuXHJcblx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgZSA9PiB7XHJcblx0XHRcdGxldCB0b3VjaG9iaiA9IGUuY2hhbmdlZFRvdWNoZXNbMF07XHJcblx0XHRcdGRpc3RYID0gdG91Y2hvYmoucGFnZVggLSBzdGFydFg7IC8vZ2V0IGhvcml6b250YWwgbW92ZVxyXG5cdFx0XHRkaXN0WSA9IHRvdWNob2JqLnBhZ2VZIC0gc3RhcnRZOyAvL2dldCB2ZXJ0aWNhbCBtb3ZlXHJcblx0XHRcdGVsYXBzZWRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBzdGFydFRpbWU7XHJcblx0XHRcdGlmIChlbGFwc2VkVGltZSA8PSBhbGxvd2VkVGltZSkge1xyXG5cdFx0XHRcdGlmIChNYXRoLmFicyhkaXN0WSkgPj0gdGhyZXNob2xkICYmIE1hdGguYWJzKGRpc3RYKSA8PSBkZXZpYXRpb24pIHsgLy92ZXJ0aWNhbCBzd2lwZVxyXG5cdFx0XHRcdFx0c3dpcGVkaXIgPSAoZGlzdFkgPCAwKSA/IF9zbGlkZVRvU2VjdGlvbihjdXJyZW50U2VjdGlvbiArIDEpIDogX3NsaWRlVG9TZWN0aW9uKGN1cnJlbnRTZWN0aW9uIC0gMSlcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH07XHJcblxyXG5cdGxldCBfc2xpZGVUb1NlY3Rpb24gPSAoaW5kZXhTZWN0aW9uKSA9PiB7XHJcblx0XHRpZiAoIXNjcm9sbCkge1xyXG5cdFx0XHRpZiAoaW5kZXhTZWN0aW9uID49IDAgJiYgaW5kZXhTZWN0aW9uIDwgY291bnRTZWN0aW9ucykge1xyXG5cdFx0XHRcdGN1cnJlbnRTZWN0aW9uID0gaW5kZXhTZWN0aW9uO1xyXG5cclxuXHRcdFx0XHRzY3JvbGwgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHRsZXQgcG9zaXRpb24gPSBpbmRleFNlY3Rpb24gKiAtMTAwICsgJyUnO1xyXG5cclxuXHRcdFx0XHRjb250ZW50LnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259KWA7XHJcblx0XHRcdFx0Y29udGVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSlgO1xyXG5cclxuXHRcdFx0XHRsZXQgc2lkZU5hdkVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBvcHRpb25zLnNpZGVOYXZpZ2F0aW9uKTtcclxuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHNpZGVOYXZFbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdFx0aWYgKGkgIT0gaW5kZXhTZWN0aW9uKSB7XHJcblx0XHRcdFx0XHRcdHNpZGVOYXZFbGVtZW50c1tpXS5jbGFzc0xpc3QucmVtb3ZlKG9wdGlvbnMuc2lkZU5hdmlnYXRpb24gKyAnLS1hY3RpdmUnKTtcclxuXHRcdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRcdHNpZGVOYXZFbGVtZW50c1tpXS5jbGFzc0xpc3QuYWRkKG9wdGlvbnMuc2lkZU5hdmlnYXRpb24gKyAnLS1hY3RpdmUnKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xyXG5cdFx0XHRcdFx0c2Nyb2xsID0gZmFsc2U7XHJcblx0XHRcdFx0fSwgMTMwMCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHQvL2hhbmRsZXJzIGZvciBrZXlib2FyZFxyXG5cdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHtcclxuXHRcdHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcblx0XHRcdGNhc2UgNDA6IC8vZG93blxyXG5cdFx0XHRcdF9zbGlkZVRvU2VjdGlvbihjdXJyZW50U2VjdGlvbiArIDEpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIDM4OiAvL3VwXHJcblx0XHRcdFx0X3NsaWRlVG9TZWN0aW9uKGN1cnJlbnRTZWN0aW9uIC0gMSk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdC8vaGFuZGxlcnMgZm9yIGxpbmtzXHJcblx0bGlzdExpbmtzLmZvckVhY2goaXRlbSA9PiB7XHJcblx0XHRpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0bGV0IGluZGV4ID0gcGFyc2VJbnQoKGUudGFyZ2V0KS5nZXRBdHRyaWJ1dGUob3B0aW9ucy5hdHRyaWJ1dGUpKTtcclxuXHRcdFx0Ly9maXggZm9yIGJ1dHRvbi1kb3duXHJcblx0XHRcdGlmICghKGluZGV4ID49IDApKSB7XHJcblx0XHRcdFx0aW5kZXggPSBwYXJzZUludCgoZS5jdXJyZW50VGFyZ2V0KS5nZXRBdHRyaWJ1dGUob3B0aW9ucy5hdHRyaWJ1dGUpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRfc2xpZGVUb1NlY3Rpb24oaW5kZXgpO1xyXG5cdFx0fSk7XHJcblx0fSk7XHJcblxyXG5cdC8vaGFuZGxlcnMgZm9yIHdoZWVsXHJcblx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignd2hlZWwnLCBlID0+IHtcclxuXHRcdGxldCBkZWx0YVkgPSBlLmRlbHRhWTtcclxuXHJcblx0XHRsZXQgaW5kZXggPSBkZWx0YVkgPiAwID8gY3VycmVudFNlY3Rpb24gKyAxIDogY3VycmVudFNlY3Rpb24gLSAxO1xyXG5cclxuXHRcdF9zbGlkZVRvU2VjdGlvbihpbmRleCk7XHJcblx0fSk7XHJcblxyXG5cdC8vaGFuZGxlcnMgZm9yIHN3aXBlXHJcblx0aWYgKGNoZWNrTW9iaWxlKSB7XHJcblx0XHRfc3dpcGVEZXRlY3RlZChjb250ZW50KTtcclxuXHR9XHJcbn07XHJcblxyXG5PbmVQYWdlU2Nyb2xsKHtcclxuXHRjb250ZW50OiAnY29udGVudCcsXHJcblx0c2VjdGlvbjogJ3NlY3Rpb24nLFxyXG5cdHNpZGVOYXZpZ2F0aW9uOiAnc2lkZS1uYXZpZ2F0aW9uX19pdGVtJyxcclxuXHRhdHRyaWJ1dGU6ICdkYXRhLXNjcm9sbC10bydcclxufSk7XHJcblxyXG4vKiBzbGlkZXIgKi9cclxubGV0IHNsaWRlciA9IG9wdGlvbnMgPT4ge1xyXG5cdGxldCB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy53cmFwcGVyKTtcclxuXHRsZXQgd2lkdGhXcmFwcGVyID0gd3JhcHBlci5jbGllbnRXaWR0aDtcclxuXHR3cmFwcGVyLnN0eWxlLndpZHRoID0gd2lkdGhXcmFwcGVyICArICdweCc7XHJcblxyXG5cdGxldCBsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy5saXN0KTtcclxuXHRsZXQgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJytvcHRpb25zLml0ZW0pO1xyXG5cclxuXHRsZXQgbGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nK29wdGlvbnMucHJldik7XHJcblx0bGV0IHJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicrb3B0aW9ucy5uZXh0KTtcclxuXHJcblx0aXRlbXMuZm9yRWFjaChlbGVtZW50ID0+IHtcclxuXHRcdGVsZW1lbnQuc3R5bGUud2lkdGggPSB3aWR0aFdyYXBwZXIgICsgJ3B4JztcclxuXHR9KTtcclxuXHJcblx0bGV0IG1pblJpZ2h0ID0gMDtcclxuXHRsZXQgbWF4UmlnaHQgPSB3aWR0aFdyYXBwZXIgKiAoaXRlbXMubGVuZ3RoIC0gMSk7XHJcblx0bGV0IHN0ZXAgPSB3aWR0aFdyYXBwZXI7XHJcblx0bGV0IGN1cnJlbnRSaWdodCA9IDA7XHJcblxyXG5cdGxldCBfc2xpZGVSaWdodCA9IHZhbHVlID0+IHtcclxuXHRcdGlmICh2YWx1ZSA8PSBtYXhSaWdodCkge1xyXG5cdFx0XHRjdXJyZW50UmlnaHQgKz0gc3RlcDtcclxuXHRcdFx0bGlzdC5zdHlsZS5yaWdodCA9IGN1cnJlbnRSaWdodCArIFwicHhcIjtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgX3NsaWRlTGVmdCA9IHZhbHVlID0+IHtcclxuXHRcdGlmICh2YWx1ZSA+PSBtaW5SaWdodCkge1xyXG5cdFx0XHRjdXJyZW50UmlnaHQgLT0gc3RlcDtcclxuXHRcdFx0bGlzdC5zdHlsZS5yaWdodCA9IGN1cnJlbnRSaWdodCArIFwicHhcIjtcclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHRsZXQgaW5pdGlhbCA9ICgpID0+IHtcclxuXHRcdGxpc3Quc3R5bGUucmlnaHQgPSBjdXJyZW50UmlnaHQ7XHJcblxyXG5cdFx0cmlnaHQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0XHRfc2xpZGVSaWdodChjdXJyZW50UmlnaHQgKyBzdGVwKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdGxlZnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0XHRfc2xpZGVMZWZ0KGN1cnJlbnRSaWdodCAtIHN0ZXApO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0X3N3aXBlRGV0ZWN0ZWQod3JhcHBlcik7XHJcblx0fTtcclxuXHJcblx0bGV0IF9zd2lwZURldGVjdGVkID0gZWxlbWVudCA9PiB7XHJcblx0XHRsZXQgc3RhcnRYLFxyXG5cdFx0XHRzdGFydFksXHJcblx0XHRcdGRpc3RYLFxyXG5cdFx0XHRkaXN0WSxcclxuXHRcdFx0ZGV2aWF0aW9uID0gMjAwLCAvL2RldmlhdGlvbiBmcm9tIG1haW4gZGlyZWN0aW9uXHJcblx0XHRcdHRocmVzaG9sZCA9IDE1MCwgLy9taW4gcmFuZ2UgZm9yIHN3aXBlXHJcblx0XHRcdGFsbG93ZWRUaW1lID0gMTAwMCwgLy9tYXggdGltZSBmb3IgcmFuZ2VcclxuXHRcdFx0ZWxhcHNlZFRpbWUsIC8vcnVudGltZVxyXG5cdFx0XHRzdGFydFRpbWU7XHJcblxyXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgZSA9PiB7XHJcblx0XHRcdGxldCB0b3VjaG9iaiA9IGUuY2hhbmdlZFRvdWNoZXNbMF07XHJcblx0XHRcdHN0YXJ0WCA9IHRvdWNob2JqLnBhZ2VYO1xyXG5cdFx0XHRzdGFydFkgPSB0b3VjaG9iai5wYWdlWTtcclxuXHRcdFx0c3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7IC8vdGltZSB0b3VjaCB3aXRoIHNlbnNvclxyXG5cdFx0fSk7XHJcblxyXG5cdFx0Ly9kaXNhYmxlIHRvdWNobW92ZVxyXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBlID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcblxyXG5cdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGUgPT4ge1xyXG5cdFx0XHRsZXQgdG91Y2hvYmogPSBlLmNoYW5nZWRUb3VjaGVzWzBdO1xyXG5cdFx0XHRkaXN0WCA9IHRvdWNob2JqLnBhZ2VYIC0gc3RhcnRYOyAvL2dldCBob3Jpem9udGFsIG1vdmVcclxuXHRcdFx0ZGlzdFkgPSB0b3VjaG9iai5wYWdlWSAtIHN0YXJ0WTsgLy9nZXQgdmVydGljYWwgbW92ZVxyXG5cdFx0XHRlbGFwc2VkVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gc3RhcnRUaW1lO1xyXG5cdFx0XHRpZiAoZWxhcHNlZFRpbWUgPD0gYWxsb3dlZFRpbWUpIHtcclxuXHRcdFx0XHRpZiAoTWF0aC5hYnMoZGlzdFgpID49IHRocmVzaG9sZCAmJiBNYXRoLmFicyhkaXN0WSkgPD0gZGV2aWF0aW9uKSB7IC8vaG9yaXpvbnRhbCBzd2lwZVxyXG5cdFx0XHRcdFx0c3dpcGVkaXIgPSAoZGlzdFggPCAwKSA/IF9zbGlkZVJpZ2h0KGN1cnJlbnRSaWdodCArIHN0ZXApIDogX3NsaWRlTGVmdChjdXJyZW50UmlnaHQgLSBzdGVwKVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fTtcclxuXHJcblx0bGV0IF9tb2JpbGVJbmdyZWRpZW50cyA9ICgpID0+IHtcclxuXHRcdGxldCBidG5JbmdyZWRpZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXJfX2luZ3JlZGllbnRzJyk7XHJcblx0XHRsZXQgYnRuQ2xvc2VJbmdyZWRpZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kcm9wZG93bl9fY2xvc2UnKTtcclxuXHJcblx0XHRidG5DbG9zZUluZ3JlZGllbnRzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRcdGJ0bkluZ3JlZGllbnRzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG5cdFx0fSk7XHJcblx0XHRidG5DbG9zZUluZ3JlZGllbnRzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBlID0+IHtcclxuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuXHRcdFx0YnRuSW5ncmVkaWVudHMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRpZiAoY2hlY2tNb2JpbGUpIHtcclxuXHRcdFx0YnRuSW5ncmVkaWVudHMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuXHRcdFx0XHRidG5JbmdyZWRpZW50cy5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdGJ0bkluZ3JlZGllbnRzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBlID0+IHtcclxuXHRcdFx0YnRuSW5ncmVkaWVudHMuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdGJ0bkluZ3JlZGllbnRzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBlID0+IHtcclxuXHRcdFx0YnRuSW5ncmVkaWVudHMuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcclxuXHRcdH0pO1xyXG5cdH07XHJcblx0X21vYmlsZUluZ3JlZGllbnRzKCk7XHJcblxyXG5cdHJldHVybiB7XHJcblx0XHRpbml0OiBpbml0aWFsXHJcblx0fVxyXG59O1xyXG5cclxuc2xpZGVyKHtcclxuXHR3cmFwcGVyOiAnYnVyZ2VyX193cmFwcGVyJyxcclxuXHRsaXN0OiAnYnVyZ2VyX19saXN0JyxcclxuXHRpdGVtOiAnYnVyZ2VyX19pdGVtJyxcclxuXHRuZXh0OiAnYnVyZ2VyX19jb250cm9scy1saW5rLS1uZXh0JyxcclxuXHRwcmV2OiAnYnVyZ2VyX19jb250cm9scy1saW5rLS1wcmV2J1xyXG59KS5pbml0KCk7XHJcblxyXG4vKiBmb3JtIG9yZGVyICovXHJcbmNvbnN0IGZvcm1PcmRlciA9ICQoXCIjZm9ybS1vcmRlclwiKTtcclxuY29uc3QgZm9ybVJlc2V0ID0gJChcIi5mb3JtX19yZXNldFwiKTtcclxuZm9ybU9yZGVyLm9uKCdzdWJtaXQnLCBmdW5jdGlvbihlKXtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRsZXQgcmVzdWx0ID0gJC5hamF4KGZvcm1PcmRlci5hdHRyKCdhY3Rpb24nKSwge1xyXG5cdFx0XHR0eXBlOiBmb3JtT3JkZXIuYXR0cignbWV0aG9kJyksXHJcblx0XHRcdGRhdGE6ICQodGhpcykuc2VyaWFsaXplKCksXHJcblx0XHRcdGRhdGFUeXBlOiAnSlNPTidcclxuXHRcdH0pO1xyXG5cclxuXHRcdHJlc3VsdC5kb25lKGZ1bmN0aW9uIChkYXRhKSB7XHJcblx0XHRcdGZvcm1SZXNldC50cmlnZ2VyKCdjbGljaycpO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0cmVzdWx0LmZhaWwoZnVuY3Rpb24gKGRhdGEpIHtcclxuXHRcdFx0Y29uc29sZS5sb2coZGF0YSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHRyZXN1bHQuYWx3YXlzKGZ1bmN0aW9uIChkYXRhKSB7XHJcblx0XHRcdGxldCBhbnN3ZXIgPSBvcGVuT3ZlcmxheSh7XHJcblx0XHRcdFx0Y2xhc3NDb250YWluZXI6ICdmb3JtX19hbnN3ZXInLFxyXG5cdFx0XHRcdGNsYXNzVGl0bGU6ICdmb3JtX19hbnN3ZXItdGl0bGUnLFxyXG5cdFx0XHRcdGNsYXNzQ2xvc2U6ICdmb3JtX19hbnN3ZXJfY2xvc2UnLFxyXG5cdFx0XHRcdGNvbnRlbnQ6IGRhdGEubXNnXHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhbnN3ZXIpO1xyXG5cdFx0fSlcclxuXHR9KTtcclxuXHJcbnZhciBvcGVuT3ZlcmxheSA9IG9wdGlvbnMgPT4ge1xyXG5cdGNvbnN0IG92ZXJsYXlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHRvdmVybGF5RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwib3ZlcmxheVwiKTtcclxuXHJcblx0Y29uc3QgY29udGFpbmVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcblx0Y29udGFpbmVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKG9wdGlvbnMuY2xhc3NDb250YWluZXIpO1xyXG5cclxuXHRjb25zdCBjb250ZW50RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcblx0Y29udGVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChvcHRpb25zLmNsYXNzVGl0bGUpO1xyXG5cdGNvbnRlbnRFbGVtZW50LnRleHRDb250ZW50ID0gb3B0aW9ucy5jb250ZW50O1xyXG5cclxuXHRjb25zdCBjbG9zZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG5cdGNsb3NlRWxlbWVudC5jbGFzc0xpc3QuYWRkKG9wdGlvbnMuY2xhc3NDbG9zZSk7XHJcblx0Y2xvc2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ29yZGVyLWxpbmsnKTtcclxuXHRjbG9zZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcItCX0LDQutGA0YvRgtGMXCI7XHJcblx0Y2xvc2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheUVsZW1lbnQpO1xyXG5cdH0pO1xyXG5cclxuXHRvdmVybGF5RWxlbWVudC5hcHBlbmRDaGlsZChjb250YWluZXJFbGVtZW50KTtcclxuXHRjb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKGNvbnRlbnRFbGVtZW50KTtcclxuXHRjb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKGNsb3NlRWxlbWVudCk7XHJcblxyXG5cdHJldHVybiBvdmVybGF5RWxlbWVudDtcclxufTtcclxuXHJcbi8qIHlhbmRleCBtYXAgKi9cclxueW1hcHMucmVhZHkoaW5pdCk7XHJcblxyXG52YXIgcGxhY2VtYXJrcyA9IFtcclxuXHRcdHtcclxuXHRcdFx0bGF0aXR1ZGU6IDU5Ljk3LFxyXG5cdFx0XHRsb25naXR1ZGU6IDMwLjMxLFxyXG5cdFx0XHRoaW50Q29udGVudDogXCLRg9C7LiDQm9C40YLQtdGA0LDRgtC+0YDQvtCyLCDQtC4gMTlcIixcclxuXHRcdFx0YmFsbG9vbkNvbnRlbnQ6IFwi0YPQuy4g0JvQuNGC0LXRgNCw0YLQvtGA0L7Qsiwg0LQuIDE5XCJcclxuXHRcdH0sXHJcblx0XHR7XHJcblx0XHRcdGxhdGl0dWRlOiA1OS45NCxcclxuXHRcdFx0bG9uZ2l0dWRlOiAzMC4yNSxcclxuXHRcdFx0aGludENvbnRlbnQ6IFwi0JzQsNC70YvQuSDQv9GA0L7RgdC/0LXQutGCINCS0J4sINC0IDY0XCIsXHJcblx0XHRcdGJhbGxvb25Db250ZW50OiBcItCc0LDQu9GL0Lkg0L/RgNC+0YHQv9C10LrRgiDQktCeLCDQtCA2NFwiXHJcblx0XHR9LFxyXG5cdFx0e1xyXG5cdFx0XHRsYXRpdHVkZTogNTkuOTMsXHJcblx0XHRcdGxvbmdpdHVkZTogMzAuMzQsXHJcblx0XHRcdGhpbnRDb250ZW50OiBcItC90LDQsS4g0YDQtdC60Lgg0KTQvtC90YLQsNC90LrQuCwg0LQuIDU2XCIsXHJcblx0XHRcdGJhbGxvb25Db250ZW50OiBcItC90LDQsS4g0YDQtdC60Lgg0KTQvtC90YLQsNC90LrQuCwg0LQuIDU2XCJcclxuXHRcdH1cclxuXHRdO1xyXG5cclxuZnVuY3Rpb24gaW5pdCgpIHtcclxuXHR2YXIgbWFwWWFuZGV4ID0gbmV3IHltYXBzLk1hcChcIm1hcC15YW5kZXhcIiwge1xyXG5cdFx0Y2VudGVyOiBbNTkuOTQsIDMwLjMyXSxcclxuXHRcdHpvb206IDEyXHJcblx0fSk7XHJcblxyXG5cdHBsYWNlbWFya3MuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XHJcblx0XHRsZXQgcGxhY2VtYXJrID0gbmV3IHltYXBzLlBsYWNlbWFyayhcclxuXHRcdFx0W29iai5sYXRpdHVkZSwgb2JqLmxvbmdpdHVkZV0sXHJcblx0XHRcdHtcclxuXHRcdFx0XHRoaW50Q29udGVudDogb2JqLmhpbnRDb250ZW50LFxyXG5cdFx0XHRcdGhpbnRDb250ZW50OiBvYmouYmFsbG9vbkNvbnRlbnRcclxuXHRcdFx0fSxcclxuXHRcdFx0e1xyXG5cdFx0XHRcdGljb25MYXlvdXQ6IFwiZGVmYXVsdCNpbWFnZVwiLFxyXG5cdFx0XHRcdGljb25JbWFnZUhyZWY6IFwiLi9pbWcvaWNvbnMvbWFwLW1hcmtlci5zdmdcIixcclxuXHRcdFx0XHRpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcclxuXHRcdFx0XHRpY29uSW1hZ2VPZmZzZXQ6IFstMTUsIC01MF1cclxuXHRcdFx0fVxyXG5cdFx0KTtcclxuXHJcblx0XHRtYXBZYW5kZXguZ2VvT2JqZWN0cy5hZGQocGxhY2VtYXJrKTtcclxuXHR9KTtcclxuXHJcblx0bWFwWWFuZGV4LmJlaGF2aW9ycy5kaXNhYmxlKFwic2Nyb2xsWm9vbVwiKTtcclxufSJdfQ==
